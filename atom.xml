<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>bug world</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://antyme.com/"/>
  <updated>2018-05-09T05:46:32.932Z</updated>
  <id>http://antyme.com/</id>
  
  <author>
    <name>bugå°è‹±é›„</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>androidç¼–è¯‘libwebpæºç </title>
    <link href="http://antyme.com/2018/05/08/android%E7%BC%96%E8%AF%91libwebp%E6%BA%90%E7%A0%81/"/>
    <id>http://antyme.com/2018/05/08/androidç¼–è¯‘libwebpæºç /</id>
    <published>2018-05-08T02:47:55.000Z</published>
    <updated>2018-05-09T05:46:32.932Z</updated>
    
    <content type="html"><![CDATA[<p>ç°åœ¨çš„Androidç‰ˆæœ¬éƒ½æ”¯æŒWebpï¼Œå¦‚æœè¦ä¸æ˜¯JNIå±‚éœ€è¦ç›´æ¥è°ƒç”¨Encodeã€Decodeç­‰APIï¼Œæ ¹æœ¬æ²¡å¿…è¦è‡ªå·±ç¼–è¯‘ã€‚ç°åœ¨å…¬å¸é¡¹ç›®éœ€è¦åœ¨c++å±‚è°ƒç”¨Encodeç”ŸæˆWebpï¼Œæ‰€ä»¥å°±è‡ªå·±ç¼–è¯‘ï¼Œæ–¹ä¾¿åç»­çš„æ›´æ–°å’Œç®¡ç†ã€‚å…¶å®Webpæºç é‡Œé¢å¯¹ä¸åŒOSçš„æ„å»ºç¼–è¯‘æ”¯æŒçš„å·²ç»å¾ˆå®Œå–„äº†ï¼Œä¾‹å¦‚iOSï¼Œç›´æ¥æ‰§è¡Œshellå°±å¯ä»¥ç”ŸæˆFrameworkï¼Œç¼–è¯‘Androidéœ€è¦ä¸€ç‚¹ç‚¹é¢å¤–å·¥ä½œéœ€è¦åšï¼Œè®°å½•ä¸‹è¿™å‡ ä¸ªæ­¥éª¤ï¼Œæ–¹ä¾¿åç»­å¥å¿˜çš„è‡ªå·±æˆ–è€…å…¶ä»–æœ‰éœ€è¦çš„äººå¯ä»¥å¿«é€Ÿç¼–è¯‘ã€‚</p>
<p>1ã€ä¸‹è½½æºç ï¼ˆgitã€httpï¼‰<br>2ã€åœ¨æºç æ ¹ç›®å½•ä¸‹æ–°å»º <code>Application.mk</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># --------------------------------------------------------------------------------------</div><div class="line"># Building Options</div><div class="line"># --------------------------------------------------------------------------------------</div><div class="line"># Application Config</div><div class="line">APP_BUILD_SCRIPT := Android.mk</div><div class="line">APP_STL := gnustl_static</div><div class="line">APP_CPPFLAGS := -D__ANDROID__ -frtti -fexceptions -std=c++11</div><div class="line">APP_ABI :=armeabi-v7a arm64-v8a</div><div class="line">#APP_ABI :=arm64-v8a</div><div class="line">#NDK_TOOLCHAIN_VERSION:=4.9</div><div class="line"></div><div class="line"># Do not to assign &apos;debug&apos; here, it may cause crash</div><div class="line">APP_OPTIM := release</div></pre></td></tr></table></figure>
<p>3ã€å¦‚æœéœ€è¦ç¼–è¯‘åŠ¨æ€åº“ï¼Œä¿®æ”¹webpæºç è‡ªå¸¦çš„Android.mkæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶åˆšå¼€å§‹ä¸€ç‚¹çš„åœ°æ–¹å®šä¹‰å˜é‡ï¼š<code>ENABLE_SHARED :=1</code>ï¼Œä¾‹å¦‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">LOCAL_PATH := $(call my-dir)</div><div class="line"></div><div class="line">WEBP_CFLAGS := -Wall -DANDROID -DHAVE_MALLOC_H -DHAVE_PTHREAD -DWEBP_USE_THREAD</div><div class="line">WEBP_CFLAGS += -fvisibility=hidden</div><div class="line"></div><div class="line">ENABLE_SHARED :=1</div><div class="line">..................................................</div><div class="line">.........................</div><div class="line">.........................</div><div class="line">.........................</div></pre></td></tr></table></figure></p>
<p>4ã€å‘½ä»¤è¡Œæ‰§è¡Œ <code>ndk-build NDK_PROJECT_PATH=. NDK_APPLICATION_MK=Application.mk</code> å³å¯ç”Ÿæˆéœ€è¦çš„soæ–‡ä»¶å’Œä¸€äº›å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç°åœ¨çš„Androidç‰ˆæœ¬éƒ½æ”¯æŒWebpï¼Œå¦‚æœè¦ä¸æ˜¯JNIå±‚éœ€è¦ç›´æ¥è°ƒç”¨Encodeã€Decodeç­‰APIï¼Œæ ¹æœ¬æ²¡å¿…è¦è‡ªå·±ç¼–è¯‘ã€‚ç°åœ¨å…¬å¸é¡¹ç›®éœ€è¦åœ¨c++å±‚è°ƒç”¨Encodeç”ŸæˆWebpï¼Œæ‰€ä»¥å°±è‡ªå·±ç¼–è¯‘ï¼Œæ–¹ä¾¿åç»­çš„æ›´æ–°å’Œç®¡ç†ã€‚å…¶å®Webpæºç é‡Œé¢å¯¹ä¸åŒOSçš„æ„å»ºç¼–è¯‘æ”¯æŒçš„
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>arm æŒ‡ä»¤</title>
    <link href="http://antyme.com/2018/04/02/arm-%E6%8C%87%E4%BB%A4/"/>
    <id>http://antyme.com/2018/04/02/arm-æŒ‡ä»¤/</id>
    <published>2018-04-02T07:52:25.000Z</published>
    <updated>2018-04-04T06:57:01.790Z</updated>
    
    <content type="html"><![CDATA[<p>ASRã€LSLã€LSRã€ROR å’Œ RRX<br>ç®—æœ¯å³ç§»ã€é€»è¾‘å·¦ç§»ã€é€»è¾‘å³ç§»ã€å‘å³å¾ªç¯ç§»å’Œå¸¦æ‰©å±•å‘å³å¾ªç¯ç§»ã€‚</p>
<p>è¯­æ³•<br>op{S}{cond} Rd, Rm, Rs<br>op{S}{cond} Rd, Rm, #sh<br>RRX{S}{cond} Rd, Rm<br>å…¶ä¸­ï¼š</p>
<p>op<br>æ˜¯ ASRã€LSLã€LSR æˆ– ROR ä¹‹ä¸€ã€‚</p>
<p>S<br>æ˜¯ä¸€ä¸ªå¯é€‰çš„åç¼€ã€‚ å¦‚æœæŒ‡å®š Sï¼Œåˆ™ä¼šæ›´æ–°è¿ç®—ç»“æœçš„æ¡ä»¶ä»£ç æ ‡è®°ï¼ˆè¯·å‚é˜…æ¡ä»¶æ‰§è¡Œï¼‰ã€‚</p>
<p>Rd<br>æ˜¯ç›®æ ‡å¯„å­˜å™¨ã€‚</p>
<p>Rm<br>æ˜¯å­˜æ”¾ç¬¬ä¸€ä¸ªæ“ä½œæ•°çš„å¯„å­˜å™¨ã€‚ æ­¤æ“ä½œæ•°å°†ä¼šè¢«å³ç§»ã€‚</p>
<p>Rs<br>æ˜¯å­˜æ”¾ç§»ä½å€¼çš„å¯„å­˜å™¨ï¼Œæ‰€å­˜æ”¾çš„ç§»ä½å€¼åº”ç”¨äº Rm ä¸­çš„å€¼ã€‚ åªä½¿ç”¨æœ€ä½æœ‰æ•ˆå­—èŠ‚ã€‚</p>
<p>sh<br>ä¸ºä¸€ä¸ªå¸¸æ•°ç§»ä½å€¼ã€‚ è¯¥å€¼çš„å…è®¸èŒƒå›´ç”±å…·ä½“æŒ‡ä»¤å†³å®šï¼š</p>
<p>ASR<br>å…è®¸ç§»åŠ¨ 1-32 ä½</p>
<p>LSL<br>å…è®¸ç§»åŠ¨ 0-31 ä½</p>
<p>LSR<br>å…è®¸ç§»åŠ¨ 1-32 ä½</p>
<p>ROR<br>å…è®¸ç§»åŠ¨ 1-31 ä½</p>
<p>ç”¨æ³•<br>ASR æä¾›é™¤ä»¥ 2 çš„å¹‚åçš„å¯„å­˜å™¨å†…å®¹çš„æœ‰ç¬¦å·å€¼ã€‚ å®ƒå¯å°†ç¬¦å·ä½å¤åˆ¶åˆ°å·¦ä¾§ç©ºå‡ºçš„ä½ä¸­ã€‚</p>
<p>LSL æä¾›ä¹˜ä»¥ 2 çš„å¹‚åçš„å¯„å­˜å™¨å†…å®¹çš„å€¼ã€‚LSR æä¾›é™¤ä»¥ 2 çš„å¯å˜æ¬¡å¹‚åçš„å¯„å­˜å™¨å†…å®¹çš„æ— ç¬¦å·å€¼ã€‚ è¿™ä¸¤ä¸ªæŒ‡ä»¤å‡ä¼šå‘ç©ºå‡ºçš„ä½ä¸­æ’å…¥é›¶ã€‚</p>
<p>ROR å¯æä¾›æŒ‰æŸä¸ªå€¼å¾ªç¯ç§»ä½åçš„å¯„å­˜å™¨å†…å®¹çš„å€¼ã€‚ ä»å³ç«¯ç§»å‡ºçš„ä½å°†ä¼šè¢«æ’å…¥åˆ°å·¦ä¾§ç©ºå‡ºçš„ä½ä¸­ã€‚</p>
<p>RRX å¯æä¾›ç»å³ç§»ä¸€ä½åçš„å¯„å­˜å™¨ä¸­çš„å€¼ã€‚ åŸå…ˆçš„è¿›ä½æ ‡è®°å°†ä¼šç§»å…¥ä½ [31]ã€‚ å¦‚æœæœ‰ S åç¼€ï¼Œåˆ™å°†åŸå…ˆçš„ä½ [0] å­˜å…¥è¿›ä½æ ‡è®°ä¸­ã€‚</p>
<p>é™åˆ¶<br>ä½¿ç”¨ Rs çš„ ARM æŒ‡ä»¤ä¸å¾—ä½¿ç”¨ r15ã€‚ Thumb æŒ‡ä»¤ä¸å¾—ä½¿ç”¨ r15 æˆ– r13ã€‚</p>
<p>æ¡ä»¶æ ‡è®°<br>å¦‚æœæŒ‡å®šäº† Sï¼Œåˆ™è¿™äº›æŒ‡ä»¤å°†ä¼šæ ¹æ®ç»“æœæ¥æ›´æ–° N å’Œ Z æ ‡è®°ã€‚</p>
<p>å¦‚æœç§»ä½å€¼ä¸º 0ï¼Œåˆ™ä¸ä¼šå½±å“ C æ ‡è®°ã€‚å¦åˆ™ï¼ŒC æ ‡è®°ä¼šæ›´æ–°ä¸ºç§»å‡ºçš„æœ€åä¸€ä½ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ASRã€LSLã€LSRã€ROR å’Œ RRX&lt;br&gt;ç®—æœ¯å³ç§»ã€é€»è¾‘å·¦ç§»ã€é€»è¾‘å³ç§»ã€å‘å³å¾ªç¯ç§»å’Œå¸¦æ‰©å±•å‘å³å¾ªç¯ç§»ã€‚&lt;/p&gt;
&lt;p&gt;è¯­æ³•&lt;br&gt;op{S}{cond} Rd, Rm, Rs&lt;br&gt;op{S}{cond} Rd, Rm, #sh&lt;br&gt;RRX{S}{cond} Rd
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ç†è§£çº¢é»‘æ ‘åŸç†</title>
    <link href="http://antyme.com/2018/02/27/%E7%90%86%E8%A7%A3%E7%BA%A2%E9%BB%91%E6%A0%91%E5%8E%9F%E7%90%86/"/>
    <id>http://antyme.com/2018/02/27/ç†è§£çº¢é»‘æ ‘åŸç†/</id>
    <published>2018-02-27T09:31:51.000Z</published>
    <updated>2018-02-27T11:00:09.525Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://mp.weixin.qq.com/s/jz1ajDUygZ7sXLQFHyfjWA" target="_blank" rel="external">å‚è€ƒé“¾æ¥</a><br>å…ˆå›é¡¾ä¸‹äºŒå‰æŸ¥æ‰¾æ ‘</p>
<ul>
<li>å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºæˆ–ç­‰äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ã€‚</li>
<li>å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºæˆ–ç­‰äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ã€‚</li>
<li>å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æ’åºæ ‘ã€‚</li>
</ul>
<hr>
<ul>
<li>èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–é»‘è‰²ã€‚</li>
<li>æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚</li>
<li>æ¯ä¸ªå¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ç©ºèŠ‚ç‚¹ï¼ˆNILèŠ‚ç‚¹ï¼‰ã€‚</li>
<li>æ¯ä¸ªçº¢è‰²èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²ã€‚(ä»æ¯ä¸ªå¶å­åˆ°æ ¹çš„æ‰€æœ‰è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹)</li>
<li>ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚<br>&lt;!â€“ - [ ] Eat</li>
</ul>
<ul>
<li>[x] Code<ul>
<li>[x] HTML</li>
<li>[x] CSS</li>
<li>[x] JavaScript</li>
</ul>
</li>
<li>[ ] Sleep â€“&gt;</li>
</ul>
<hr>
<h1 id="lt-â€“-Hello"><a href="#lt-â€“-Hello" class="headerlink" title="&lt;!â€“ Hello"></a>&lt;!â€“ Hello</h1><p>I like <a href="https://www.google.com/" target="_blank" rel="external">Google</a> â€“&gt;</p>
<p>ä¸‹å›¾ä¸­è¿™æ£µæ ‘ï¼Œå°±æ˜¯ä¸€é¢—å…¸å‹çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼š<br><img src="/images/BST.webp" alt=""></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> idx = <span class="number">0</span>; idx &lt; size/<span class="keyword">sizeof</span>(<span class="keyword">void</span>*); ++idx)&#123;</div><div class="line">    <span class="keyword">char</span> *<span class="built_in">string</span> = (<span class="keyword">char</span>*)memory[idx];</div><div class="line"></div><div class="line">    NSString *str = [NSString stringWithUTF8String:<span class="built_in">string</span>];</div><div class="line">    <span class="keyword">if</span>(!str)<span class="keyword">continue</span>;</div><div class="line"></div><div class="line">    BHLog(@<span class="string">"config = %@"</span>, str);</div><div class="line">    <span class="keyword">if</span>(str) [configs addObject:str];</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/jz1ajDUygZ7sXLQFHyfjWA&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;å‚è€ƒé“¾æ¥&lt;/a&gt;&lt;br&gt;å…ˆå›é¡¾ä¸‹äºŒå‰æŸ¥æ‰¾æ ‘&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡
    
    </summary>
    
    
      <category term="ç®—æ³•" scheme="http://antyme.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Macå‘½ä»¤è¡Œç»ˆç«¯ä¸‹ä½¿ç”¨shadowsocksç¿»å¢™</title>
    <link href="http://antyme.com/2018/01/20/Mac%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%BB%88%E7%AB%AF%E4%B8%8B%E4%BD%BF%E7%94%A8shadowsocks%E7%BF%BB%E5%A2%99/"/>
    <id>http://antyme.com/2018/01/20/Macå‘½ä»¤è¡Œç»ˆç«¯ä¸‹ä½¿ç”¨shadowsocksç¿»å¢™/</id>
    <published>2018-01-20T09:53:08.000Z</published>
    <updated>2018-01-20T10:37:15.627Z</updated>
    
    <content type="html"><![CDATA[<p>å¾ˆèˆ’æœï¼ğŸ˜ï¼</p>
<p><a href="http://www.cashqian.net/blog/001486989831982332565298e4942a2bb8f56b08f9d2475000" target="_blank" rel="external">Macå‘½ä»¤è¡Œç»ˆç«¯ä¸‹ä½¿ç”¨shadowsocksç¿»å¢™
</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¾ˆèˆ’æœï¼ğŸ˜ï¼&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cashqian.net/blog/001486989831982332565298e4942a2bb8f56b08f9d2475000&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;M
    
    </summary>
    
    
      <category term="å·¥å…·" scheme="http://antyme.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>iOSå›¾å½¢å¯¹è±¡ç†è§£</title>
    <link href="http://antyme.com/2017/04/17/iOS%E5%9B%BE%E5%BD%A2%E5%AF%B9%E8%B1%A1%E7%90%86%E8%A7%A3/"/>
    <id>http://antyme.com/2017/04/17/iOSå›¾å½¢å¯¹è±¡ç†è§£/</id>
    <published>2017-04-17T03:11:20.000Z</published>
    <updated>2017-04-17T03:11:20.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Beehiveæºç ç®€æ</title>
    <link href="http://antyme.com/2017/04/08/SDK%E4%B8%AD%E4%B8%80%E6%AC%A1Beehive%E5%AE%9E%E8%B7%B5/"/>
    <id>http://antyme.com/2017/04/08/SDKä¸­ä¸€æ¬¡Beehiveå®è·µ/</id>
    <published>2017-04-07T16:00:00.000Z</published>
    <updated>2017-04-11T12:27:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒé“¾æ¥ï¼š</p>
<p><a href="https://github.com/alibaba/BeeHive" target="_blank" rel="external">alibaba/BeeHive</a></p>
<p><a href="https://halfrost.com/beehive/" target="_blank" rel="external">BeeHive â€”â€” ä¸€ä¸ªä¼˜é›…ä½†è¿˜åœ¨å®Œå–„ä¸­çš„è§£è€¦æ¡†æ¶</a></p>
<h3 id="BeeHiveæ¦‚è¿°"><a href="#BeeHiveæ¦‚è¿°" class="headerlink" title="BeeHiveæ¦‚è¿°"></a>BeeHiveæ¦‚è¿°</h3><p><img src="/images/beehive.png" alt=""></p>
<p>BeeHiveæ˜¯ç”¨äºiOSçš„Appæ¨¡å—åŒ–ç¼–ç¨‹çš„æ¡†æ¶å®ç°æ–¹æ¡ˆï¼Œå¸æ”¶äº†Springæ¡†æ¶Serviceçš„ç†å¿µæ¥å®ç°æ¨¡å—é—´çš„APIè€¦åˆã€‚</p>
<p>ç›®å‰BeeHive v1.2.0 å…¨éƒ¨æ˜¯åˆ©ç”¨Protocolçš„æ–¹å¼ï¼Œå®ç°äº†æ¨¡å—é—´è§£è€¦çš„ç›®çš„ï¼š</p>
<ol>
<li>å„ä¸ªæ¨¡å—ä»¥æ’ä»¶çš„å½¢å¼å­˜åœ¨ã€‚æ¯ä¸ªéƒ½å¯ç‹¬ç«‹ï¼Œç›¸äº’è§£è€¦ã€‚ </li>
<li>å„ä¸ªæ¨¡å—å…·ä½“å®ç°ä¸æ¥å£è°ƒç”¨åˆ†ç¦» </li>
<li>å„ä¸ªæ¨¡å—ä¹Ÿæœ‰ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå¯ä»¥è¿›è¡Œç®¡ç†ã€‚</li>
</ol>
<h3 id="BeeHiveæ¨¡å—æ³¨å†Œ"><a href="#BeeHiveæ¨¡å—æ³¨å†Œ" class="headerlink" title="BeeHiveæ¨¡å—æ³¨å†Œ"></a>BeeHiveæ¨¡å—æ³¨å†Œ</h3><p>å…ˆä»æ¨¡å—çš„æ³¨å†Œå¼€å§‹åˆ†æï¼Œæ¥çœ‹çœ‹BeeHiveæ˜¯å¦‚ä½•ç»™å„ä¸ªæ¨¡å—è¿›è¡Œæ³¨å†Œçš„ã€‚</p>
<p>åœ¨BeeHiveä¸­æ˜¯é€šè¿‡BHModuleManageræ¥ç®¡ç†å„ä¸ªæ¨¡å—çš„ã€‚BHModuleManagerä¸­åªä¼šç®¡ç†å·²ç»è¢«æ³¨å†Œè¿‡çš„æ¨¡å—ã€‚</p>
<p>æ³¨å†ŒModuleçš„æ–¹å¼æ€»å…±æœ‰ä¸‰ç§ï¼š</p>
<h5 id="Annotationæ–¹å¼æ³¨å†Œ"><a href="#Annotationæ–¹å¼æ³¨å†Œ" class="headerlink" title="Annotationæ–¹å¼æ³¨å†Œ"></a>Annotationæ–¹å¼æ³¨å†Œ</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">BeeHiveService(HomeServiceProtocol,BHViewController)</div></pre></td></tr></table></figure>
<p>BeeHiveServiceå®å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#define BeeHiveService(servicename,impl) \</div><div class="line">char * k##servicename##_service BeeHiveDATA(BeehiveServices) = &quot;&#123; \&quot;&quot;#servicename&quot;\&quot; : \&quot;&quot;#impl&quot;\&quot;&#125;&quot;;</div></pre></td></tr></table></figure>
<p>BeeHiveDATAåˆæ˜¯ä¸€ä¸ªå®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#define BeeHiveDATA(sectname) __attribute((used, section(&quot;__DATA,&quot;#sectname&quot; &quot;)))</div></pre></td></tr></table></figure>
<p>æœ€ç»ˆBeeHiveServiceå®ä¼šåœ¨é¢„ç¼–è¯‘ç»“æŸä¼šå®Œå…¨å±•å¼€æˆä¸‹é¢çš„æ ·å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">char * kHomeServiceProtocol_service __attribute((used, section(&quot;__DATA,&quot;&quot;BeehiveServices&quot;&quot; &quot;))) = &quot;&#123; \&quot;&quot;&quot;HomeServiceProtocol&quot;&quot;\&quot; : \&quot;&quot;&quot;BHViewController&quot;&quot;\&quot;&#125;&quot;;</div></pre></td></tr></table></figure>
<p>åˆ°è¿™é‡Œ__attribute((used,section(â€œsegmentname,sectionnameâ€)))å°±éœ€è¦å…ˆè¯´æ˜2ä¸ªåœ°æ–¹ã€‚</p>
<p>__attributeç¬¬ä¸€ä¸ªå‚æ•°usedå¾ˆæœ‰ç”¨ã€‚è¿™ä¸ªå…³é”®å­—æ˜¯ç”¨æ¥ä¿®é¥°å‡½æ•°çš„ã€‚è¢«usedä¿®é¥°ä»¥åï¼Œæ„å‘³ç€å³ä½¿å‡½æ•°æ²¡æœ‰è¢«å¼•ç”¨ï¼Œåœ¨Releaseä¸‹ä¹Ÿä¸ä¼šè¢«ä¼˜åŒ–ã€‚å¦‚æœä¸åŠ è¿™ä¸ªä¿®é¥°ï¼Œé‚£ä¹ˆReleaseç¯å¢ƒé“¾æ¥å™¨ä¸‹ä¼šå»æ‰æ²¡æœ‰è¢«å¼•ç”¨çš„æ®µã€‚å…·ä½“çš„æè¿°å¯ä»¥çœ‹è¿™ä¸ªgunçš„<a href="https://gcc.gnu.org/onlinedocs/gcc-3.2/gcc/Variable-Attributes.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">section (&quot;section-name&quot;)</div><div class="line">Normally, the compiler places the objects it generates in sections like data and bss. Sometimes, however, you need additional sections, or you need certain particular variables to appear in special sections, for example to map to special hardware. The section attribute specifies that a variable (or function) lives in a particular section. For example, this small program uses several specific section names:</div><div class="line">          struct duart a __attribute__ ((section (&quot;DUART_A&quot;))) = &#123; 0 &#125;;</div><div class="line">          struct duart b __attribute__ ((section (&quot;DUART_B&quot;))) = &#123; 0 &#125;;</div><div class="line">          char stack[10000] __attribute__ ((section (&quot;STACK&quot;))) = &#123; 0 &#125;;</div><div class="line">          int init_data __attribute__ ((section (&quot;INITDATA&quot;))) = 0;</div><div class="line">          </div><div class="line">          main()</div><div class="line">          &#123;</div><div class="line">            /* Initialize stack pointer */</div><div class="line">            init_sp (stack + sizeof (stack));</div><div class="line">          </div><div class="line">            /* Initialize initialized data */</div><div class="line">            memcpy (&amp;init_data, &amp;data, &amp;edata - &amp;data);</div><div class="line">          </div><div class="line">            /* Turn on the serial ports */</div><div class="line">            init_duart (&amp;a);</div><div class="line">            init_duart (&amp;b);</div><div class="line">          &#125;</div><div class="line">          </div><div class="line">Use the section attribute with an initialized definition of a global variable, as shown in the example. GCC issues a warning and otherwise ignores the section attribute in uninitialized variable declarations.</div><div class="line"></div><div class="line">You may only use the section attribute with a fully initialized global definition because of the way linkers work. The linker requires each object be defined once, with the exception that uninitialized variables tentatively go in the common (or bss) section and can be multiply &quot;defined&quot;. You can force a variable to be initialized with the -fno-common flag or the nocommon attribute.</div><div class="line"></div><div class="line">Some file formats do not support arbitrary sections so the section attribute is not available on all platforms. If you need to map the entire contents of a module to a particular section, consider using the facilities of the linker instead.</div></pre></td></tr></table></figure>
<p>Staticé™æ€å˜é‡ä¼šæŒ‰ç…§ä»–ä»¬ç”³æ˜çš„é¡ºåºï¼Œæ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„æ®µä¸­ã€‚æˆ‘ä»¬é€šè¿‡ä½¿ç”¨<strong>attribute</strong>((section(â€œnameâ€)))æ¥æŒ‡æ˜å“ªä¸ªæ®µã€‚æ•°æ®åˆ™ç”¨<strong>attribute</strong>((used))æ¥æ ‡è®°ï¼Œé˜²æ­¢é“¾æ¥å™¨ä¼šä¼˜åŒ–åˆ é™¤æœªè¢«ä½¿ç”¨çš„æ®µã€‚</p>
<p>å†æ¥å…·ä½“è¯´è¯´sectionçš„ä½œç”¨ã€‚</p>
<p>ç¼–è¯‘å™¨ç¼–è¯‘æºä»£ç åç”Ÿæˆçš„æ–‡ä»¶å«ç›®æ ‡æ–‡ä»¶ï¼Œä»æ–‡ä»¶ç»“æ„ä¸Šæ¥è¯´ï¼Œå®ƒå·²ç»æ˜¯ç¼–è¯‘åå¯æ‰§è¡Œçš„æ–‡ä»¶æ ¼å¼ï¼Œåªæ˜¯è¿˜æ²¡æœ‰ç»è¿‡é“¾æ¥çš„è¿‡ç¨‹ã€‚å¯æ‰§è¡Œæ–‡ä»¶(Executable)ä¸»è¦æ˜¯Windowsä¸‹çš„PE(Portable Executable)å’ŒLinuxçš„ELF(Executable Linkable Format)ï¼Œå®ƒä»¬ä¹Ÿéƒ½æ˜¯COFF(Common file format)æ ¼å¼çš„å˜ç§ã€‚ç¨‹åºæºç¨‹åºä»£ç è¢«ç¼–è¯‘ä¹‹åä¼šä¸»è¦åˆ†æˆä¸¤ä¸ªæ®µï¼šç¨‹åºæŒ‡ä»¤å’Œç¨‹åºæ•°æ®ã€‚ä»£ç æ®µå±äºç¨‹åºæŒ‡ä»¤ï¼Œæ•°æ®æ®µå’Œ.bssæ®µå±äºæ•°æ®æ®µã€‚</p>
<p>å¯æ‰§è¡Œæ–‡ä»¶ç»“æ„å›¾ï¼š</p>
<p><img src="/images/elf.png" alt=""></p>
<p>Moduleè¢«è¿™æ ·å­˜åˆ°äº†ç‰¹æ®Šçš„æ®µä¸­ï¼Œé‚£æ€ä¹ˆå–å‡ºæ¥çš„å‘¢ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">static NSArray&lt;NSString *&gt;* BHReadConfiguration(char *section)  </div><div class="line">&#123;</div><div class="line">    NSMutableArray *configs = [NSMutableArray array];</div><div class="line"></div><div class="line">    Dl_info info;</div><div class="line">    dladdr(BHReadConfiguration, &amp;info);</div><div class="line"></div><div class="line">#ifndef __LP64__</div><div class="line">    // const struct mach_header *mhp = _dyld_get_image_header(0); // both works as below line</div><div class="line">    const struct mach_header *mhp = (struct mach_header*)info.dli_fbase;</div><div class="line">    unsigned long size = 0;</div><div class="line">    // æ‰¾åˆ°ä¹‹å‰å­˜å‚¨çš„æ•°æ®æ®µ(Moduleæ‰¾BeehiveModsæ®µ å’Œ Serviceæ‰¾BeehiveServicesæ®µ)çš„ä¸€ç‰‡å†…å­˜</div><div class="line">    uint32_t *memory = (uint32_t*)getsectiondata(mhp, &quot;__DATA&quot;, section, &amp; size);</div><div class="line">#else /* defined(__LP64__) */</div><div class="line">    const struct mach_header_64 *mhp = (struct mach_header_64*)info.dli_fbase;</div><div class="line">    unsigned long size = 0;</div><div class="line">    uint64_t *memory = (uint64_t*)getsectiondata(mhp, &quot;__DATA&quot;, section, &amp; size);</div><div class="line">#endif /* defined(__LP64__) */</div><div class="line"></div><div class="line">    // æŠŠç‰¹æ®Šæ®µé‡Œé¢çš„æ•°æ®éƒ½è½¬æ¢æˆå­—ç¬¦ä¸²å­˜å…¥æ•°ç»„ä¸­</div><div class="line">    for(int idx = 0; idx &lt; size/sizeof(void*); ++idx)&#123;</div><div class="line">        char *string = (char*)memory[idx];</div><div class="line"></div><div class="line">        NSString *str = [NSString stringWithUTF8String:string];</div><div class="line">        if(!str)continue;</div><div class="line"></div><div class="line">        BHLog(@&quot;config = %@&quot;, str);</div><div class="line">        if(str) [configs addObject:str];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return configs;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é€šè¿‡è°ƒç”¨è¿™ä¸ªstaticå‡½æ•°BHReadConfigurationï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°ä¹‹å‰æ³¨å†Œåˆ°BeehiveModsç‰¹æ®Šæ®µé‡Œé¢çš„å„ä¸ªModuleçš„ç±»åï¼Œéƒ½ç”¨å­—ç¬¦ä¸²è£…åœ¨æ•°æ®é‡Œã€‚</p>
<h5 id="è¯»å–æœ¬åœ°Pilstæ–‡ä»¶"><a href="#è¯»å–æœ¬åœ°Pilstæ–‡ä»¶" class="headerlink" title="è¯»å–æœ¬åœ°Pilstæ–‡ä»¶"></a>è¯»å–æœ¬åœ°Pilstæ–‡ä»¶</h5><p>è¦è¯»å–æœ¬åœ°çš„Plistæ–‡ä»¶ä¹‹å‰ï¼Œéœ€è¦å…ˆè®¾ç½®å¥½è·¯å¾„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[BHContext shareInstance].moduleConfigName = @&quot;BeeHive.bundle/BeeHive&quot;;</div></pre></td></tr></table></figure></p>
<p><img src="/images/plist.png" alt=""></p>
<h5 id="Loadæ–¹æ³•æ³¨å†Œ"><a href="#Loadæ–¹æ³•æ³¨å†Œ" class="headerlink" title="Loadæ–¹æ³•æ³¨å†Œ"></a>Loadæ–¹æ³•æ³¨å†Œ</h5><p>æœ€åä¸€ç§æ³¨å†ŒModuleçš„æ–¹æ³•å°±æ˜¯åœ¨Loadæ–¹æ³•é‡Œé¢æ³¨å†ŒModuleçš„ç±»ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">+ (void)load</div><div class="line">&#123;</div><div class="line">    [BeeHive registerDynamicModule:[self class]];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)registerService:(Protocol *)service implClass:(Class)implClass</div><div class="line">&#123;</div><div class="line">    NSParameterAssert(service != nil);</div><div class="line">    NSParameterAssert(implClass != nil);</div><div class="line"></div><div class="line">    // impClass æ˜¯å¦éµå¾ªäº† Protocol åè®®</div><div class="line">    if (![implClass conformsToProtocol:service] &amp;&amp; self.enableException) &#123;</div><div class="line">        @throw [NSException exceptionWithName:NSInternalInconsistencyException reason:[NSString stringWithFormat:@&quot;%@ module does not comply with %@ protocol&quot;, NSStringFromClass(implClass), NSStringFromProtocol(service)] userInfo:nil];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // Protocol åè®®æ˜¯å¦å·²ç»æ³¨å†Œè¿‡äº†</div><div class="line">    if ([self checkValidService:service] &amp;&amp; self.enableException) &#123;</div><div class="line">        @throw [NSException exceptionWithName:NSInternalInconsistencyException reason:[NSString stringWithFormat:@&quot;%@ protocol has been registed&quot;, NSStringFromProtocol(service)] userInfo:nil];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    NSMutableDictionary *serviceInfo = [NSMutableDictionary dictionary];</div><div class="line">    [serviceInfo setObject:NSStringFromProtocol(service) forKey:kService];</div><div class="line">    [serviceInfo setObject:NSStringFromClass(implClass) forKey:kImpl];</div><div class="line"></div><div class="line">    [self.lock lock];</div><div class="line">    [self.allServices addObject:serviceInfo];</div><div class="line">    [self.lock unlock];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="BeeHiveæ¨¡å—è°ƒç”¨"><a href="#BeeHiveæ¨¡å—è°ƒç”¨" class="headerlink" title="BeeHiveæ¨¡å—è°ƒç”¨"></a>BeeHiveæ¨¡å—è°ƒç”¨</h3><p>åœ¨BeeHiveä¸­è°ƒç”¨ä»¥ä¸‹æ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªèƒ½ç›¸åº”Protocolçš„å®ä¾‹å¯¹è±¡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">- (id)createService:(Protocol *)proto;</div><div class="line"></div><div class="line">- (id)createService:(Protocol *)proto;</div><div class="line">&#123;</div><div class="line">    return [[BHServiceManager sharedManager] createService:proto];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (id)createService:(Protocol *)service</div><div class="line">&#123;</div><div class="line">    id implInstance = nil;</div><div class="line"></div><div class="line">    // Protocol åè®®æ˜¯å¦å·²ç»æ³¨å†Œè¿‡äº†</div><div class="line">    if (![self checkValidService:service] &amp;&amp; self.enableException) &#123;</div><div class="line">        @throw [NSException exceptionWithName:NSInternalInconsistencyException reason:[NSString stringWithFormat:@&quot;%@ protocol does not been registed&quot;, NSStringFromProtocol(service)] userInfo:nil];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Class implClass = [self serviceImplClass:service];</div><div class="line"></div><div class="line">    if ([[implClass class] respondsToSelector:@selector(shareInstance)])</div><div class="line">        implInstance = [[implClass class] shareInstance];</div><div class="line">    else</div><div class="line">        implInstance = [[implClass alloc] init];</div><div class="line"></div><div class="line">    if (![implInstance respondsToSelector:@selector(singleton)]) &#123;</div><div class="line">        return implInstance;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    NSString *serviceStr = NSStringFromProtocol(service);</div><div class="line"></div><div class="line">    // æ˜¯å¦éœ€è¦ç¼“å­˜</div><div class="line">    if ([implInstance singleton]) &#123;</div><div class="line">        id protocol = [[BHContext shareInstance] getServiceInstanceFromServiceName:serviceStr];</div><div class="line"></div><div class="line">        if (protocol) &#123;</div><div class="line">            return protocol;</div><div class="line">        &#125; else &#123;</div><div class="line">            [[BHContext shareInstance] addServiceWithImplInstance:implInstance serviceName:serviceStr];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125; else &#123;</div><div class="line">        [[BHContext shareInstance] addServiceWithImplInstance:implInstance serviceName:serviceStr];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return implInstance;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šå…ˆæ£€æŸ¥Protocolåè®®æ˜¯å¦æ˜¯æ³¨å†Œè¿‡çš„ã€‚ç„¶åæ¥ç€å–å‡ºå­—å…¸é‡Œé¢å¯¹åº”çš„Classï¼Œå¦‚æœå®ç°äº†shareInstanceæ–¹æ³•ï¼Œé‚£ä¹ˆå°±ç”Ÿæˆä¸€ä¸ªå•ä¾‹å‡ºæ¥ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±éšä¾¿ç”Ÿæˆä¸€ä¸ªå¯¹è±¡å‡ºæ¥ã€‚å¦‚æœè¿˜å®ç°äº†singletonï¼Œå°±èƒ½è¿›ä¸€æ­¥çš„æŠŠimplInstanceå’ŒserviceStrå¯¹åº”çš„åŠ åˆ°BHContextçš„servicesByNameå­—å…¸é‡Œé¢ç¼“å­˜èµ·æ¥ã€‚è¿™æ ·å°±å¯ä»¥éšç€ä¸Šä¸‹æ–‡ä¼ é€’äº†ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>é€šå¸¸ä¼šæœ‰ä¸‰ç§å½¢å¼çš„æ¥å£è®¿é—®å½¢å¼ï¼š</p>
<ul>
<li>åŸºäºæ¥å£çš„å®ç°Serviceè®¿é—®æ–¹å¼ï¼ˆJava springæ¡†æ¶å®ç°ï¼‰</li>
<li>åŸºäºå‡½æ•°è°ƒç”¨çº¦å®šå®ç°çš„Export Method(PHPçš„extensionï¼ŒReactNativeçš„æ‰©å±•æœºåˆ¶)</li>
<li>åŸºäºè·¨åº”ç”¨å®ç°çš„URL Routeæ¨¡å¼(iPhone Appä¹‹é—´çš„äº’è®¿)</li>
</ul>
<p>BeeHiveç›®å‰åªå®ç°äº†ç¬¬ä¸€ç§æ–¹å¼ï¼Œåä¸¤ç§æ–¹å¼è¿˜éœ€è¦ç»§ç»­å®Œå–„ã€‚</p>
<p>åŸºäºæ¥å£Serviceè®¿é—®çš„ä¼˜ç‚¹æ˜¯å¯ä»¥ç¼–è¯‘æ—¶æ£€æŸ¥å‘ç°æ¥å£çš„å˜æ›´ï¼Œä»è€ŒåŠæ—¶ä¿®æ­£æ¥å£é—®é¢˜ã€‚ç¼ºç‚¹æ˜¯éœ€è¦ä¾èµ–æ¥å£å®šä¹‰çš„å¤´æ–‡ä»¶ï¼Œé€šè¿‡æ¨¡å—å¢åŠ å¾—è¶Šå¤šï¼Œç»´æŠ¤æ¥å£å®šä¹‰çš„ä¹Ÿæœ‰ä¸€å®šå·¥ä½œé‡ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‚è€ƒé“¾æ¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/alibaba/BeeHive&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;alibaba/BeeHive&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://half
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOS SDK cocoapodå®è·µï¼šæºç ç®¡ç†å’ŒäºŒè¿›åˆ¶å‘å¸ƒ</title>
    <link href="http://antyme.com/2017/04/07/iOS-SDK-cocoapod%E5%AE%9E%E8%B7%B5%EF%BC%9A%E6%BA%90%E7%A0%81%E7%AE%A1%E7%90%86%E5%92%8C%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8F%91%E5%B8%83/"/>
    <id>http://antyme.com/2017/04/07/iOS-SDK-cocoapodå®è·µï¼šæºç ç®¡ç†å’ŒäºŒè¿›åˆ¶å‘å¸ƒ/</id>
    <published>2017-04-07T06:42:49.000Z</published>
    <updated>2017-04-11T12:26:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒé“¾æ¥ï¼š</p>
<p><a href="http://www.infoq.com/cn/articles/cocoapods-binarization" target="_blank" rel="external">CocoaPodsç»„ä»¶å¹³æ»‘äºŒè¿›åˆ¶åŒ–è§£å†³æ–¹æ¡ˆ</a></p>
<p><a href="http://guides.cocoapods.org/syntax/podspec.html" target="_blank" rel="external">Podspec Syntax Reference</a></p>
<p><a href="http://guides.cocoapods.org/syntax/podfile.html" target="_blank" rel="external">Podfile Syntax Reference</a></p>
<p><a href="https://objccn.io/issue-6-4/" target="_blank" rel="external">æ·±å…¥ç†è§£ CocoaPods</a></p>
<h3 id="è®¤è¯†SDK"><a href="#è®¤è¯†SDK" class="headerlink" title="è®¤è¯†SDK"></a>è®¤è¯†SDK</h3><p>æ— è®ºè´Ÿè´£æ¡Œé¢è½¯ä»¶ã€æœåŠ¡ç«¯ã€å‰ç«¯ã€appè¿˜æ˜¯å…¶ä»–ååº”ç”¨å±‚çš„äº§å“ï¼Œæ—¶è‡³ä»Šæ—¥çš„ä»£ç å·¥ä½œè€…ä»¬åŸºæœ¬éƒ½æœ‰ç¬¬ä¸‰æ–¹SDKæˆ–è€…å¼€æºåº“ï¼ˆ.dll .a .framework .jar .soç­‰ï¼‰çš„ä½¿ç”¨ç»å†ï¼Œæ¯ä¸ªäººå¯¹ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“å¥½ä¸å¥½ç”¨ï¼Œä¸“ä¸šä¸ä¸“ä¸šçš„è¯„åˆ¤ä¾§é‡ç‚¹ä¸ä¸€æ ·ï¼Œä½†å¤§è‡´å¯ä»¥å½’ä¸ºå¦‚ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<h5 id="æ„Ÿæ€§ï¼š"><a href="#æ„Ÿæ€§ï¼š" class="headerlink" title="æ„Ÿæ€§ï¼š"></a>æ„Ÿæ€§ï¼š</h5><ul>
<li>æ–‡ä»¶ç»„ç»‡æ–¹å¼æ¸…æ™°æ˜äº†</li>
<li>ç±»åå‰ç¼€å’ŒåŒ…å‘½åæˆ–è€…ç¼©å†™è¦ä¸€è‡´</li>
<li>ä»£ç é£æ ¼ä¸€å®šè¦ä¸€è‡´</li>
<li>å‡½æ•°å‘½åéµå¾ªå…±æ€§ï¼Œä¸è¦å‡ºç°æ­§ä¹‰æˆ–è€…è¿èƒŒå¤§å®¶çš„å…±è¯†</li>
<li>ä»£ç æ³¨é‡Šè¦è§„èŒƒå’Œæ¸…æ¥š</li>
<li>SDKåŠŸèƒ½æ­£ç¡®ï¼Œç¼–è¯‘æ— è­¦å‘Šå’Œé”™è¯¯ï¼Œæ”¯æŒæœ€æ–°çš„ç‰¹æ€§</li>
</ul>
<h5 id="ç†æ€§ï¼š"><a href="#ç†æ€§ï¼š" class="headerlink" title="ç†æ€§ï¼š"></a>ç†æ€§ï¼š</h5><hr>
<ul>
<li>SDKé›†æˆæˆæœ¬</li>
<li>APIè°ƒç”¨ç®€å•</li>
<li>åŠŸèƒ½å¯ä»¥å®šåˆ¶</li>
<li>ä¾¿äºè°ƒè¯•</li>
<li>APIå›è°ƒå‚æ•°æ˜ç¡®</li>
<li>APIç¨³å®š</li>
<li>å‚æ•°å‘½åä¸€å®šè¦æ˜ç¡®æ— æ­§ä¹‰</li>
<li>è‡ªç»™è‡ªè¶³ï¼Œä¸°è¡£è¶³é£Ÿ</li>
<li>SDKé…ç½®å‚æ•°å’Œæ¥å£å…¥å‚åˆ†å¼€</li>
<li>SDKå‚æ•°ï¼šæ‹¼æ¥çš„å­—ç¬¦ä¸²</li>
<li>åŒä¸€ç±»å‚æ•°ï¼Œå°è£…æˆmodelï¼Œéšè—å±æ€§ï¼Œé€šè¿‡æ–¹æ³•æ„é€ </li>
<li>APIåŠŸèƒ½å•ä¸€ï¼Œå‡å°‘ç±»ä¼¼enumçš„å…¥å‚è®¾è®¡</li>
<li>ç”¨äºæŸ¥è¯¢çš„å±æ€§ï¼Œç»å¯¹ä¸èƒ½ç›´æ¥è®¾ç½®</li>
<li>API å›è°ƒè®¾è®¡</li>
</ul>
<h5 id="å‘å¸ƒï¼š"><a href="#å‘å¸ƒï¼š" class="headerlink" title="å‘å¸ƒï¼š"></a>å‘å¸ƒï¼š</h5><ul>
<li>SDKæ‰“åŒ…å½¢å¼</li>
<li>å‘å¸ƒæ¸ é“</li>
<li>æ–‡æ¡£</li>
<li>demo</li>
<li>æ¥å…¥å¸®åŠ©</li>
</ul>
<h5 id="Cocoapodsï¼š"><a href="#Cocoapodsï¼š" class="headerlink" title="Cocoapodsï¼š"></a>Cocoapodsï¼š</h5><p>ä¸Šé¢è¿™äº›ç‚¹åŸºæœ¬ä¸Šå¯ä»¥è¡¡é‡å‡ºä¸€ä¸ªSDKæä¾›æ–¹èµ°ä¸èµ°å¿ƒï¼Œä¸“ä¸ä¸“ä¸šã€‚ä½œä¸ºiOSä»ä¸šè€…ï¼Œcocoapodsè¿™ä¸œè¥¿åº”è¯¥æ˜¯æ— äººä¸çŸ¥æ— äººä¸æ™“çš„ï¼ˆå‡å¦‚ä½ çœŸä¸çŸ¥é“ï¼Œå»æAndroidå§ï¼‰ï¼ŒObjCä¸­å›½ä¸€ç¯‡æ·±å…¥ç†è§£cocoapodsçš„æ–‡ç« ä¸­å¯¹cocoapodsçš„åŠŸèƒ½æè¿°ï¼š</p>
<blockquote>
<p>CocoaPods æ˜¯å¼€å‘ OS X å’Œ iOS åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“çš„ä¾èµ–ç®¡ç†å·¥å…·ã€‚åˆ©ç”¨ CocoaPodsï¼Œå¯ä»¥å®šä¹‰è‡ªå·±çš„ä¾èµ–å…³ç³» (ç§°ä½œ pods)ï¼Œå¹¶ä¸”éšç€æ—¶é—´çš„å˜åŒ–ï¼Œä»¥åŠåœ¨æ•´ä¸ªå¼€å‘ç¯å¢ƒä¸­å¯¹ç¬¬ä¸‰æ–¹åº“çš„ç‰ˆæœ¬ç®¡ç†éå¸¸æ–¹ä¾¿ã€‚</p>
<p>CocoaPods èƒŒåçš„ç†å¿µä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ã€‚é¦–å…ˆï¼Œåœ¨å·¥ç¨‹ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹ä»£ç ä¼šæ¶‰åŠåˆ°è®¸å¤šå†…å®¹ã€‚é’ˆå¯¹ Objective-C åˆçº§å¼€å‘è€…æ¥è¯´ï¼Œå·¥ç¨‹æ–‡ä»¶çš„é…ç½®ä¼šè®©äººå¾ˆæ²®ä¸§ã€‚åœ¨é…ç½® build phases å’Œ linker flags è¿‡ç¨‹ä¸­ï¼Œä¼šå¼•èµ·è®¸å¤šäººä¸ºå› ç´ çš„é”™è¯¯ã€‚CocoaPods ç®€åŒ–äº†è¿™ä¸€åˆ‡ï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨é…ç½®ç¼–è¯‘é€‰é¡¹ã€‚</p>
<p>å…¶æ¬¡ï¼Œé€šè¿‡ CocoaPodsï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æŸ¥æ‰¾åˆ°æ–°çš„ç¬¬ä¸‰æ–¹åº“ã€‚å½“ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯è¯´ä½ å¯ä»¥ç®€å•çš„å°†åˆ«äººæä¾›çš„åº“æ‹¿æ¥æ‹¼å‡‘æˆä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚å®ƒçš„çœŸæ­£ä½œç”¨æ˜¯è®©ä½ èƒ½å¤Ÿæ‰¾åˆ°çœŸæ­£å¥½ç”¨çš„åº“ï¼Œä»¥æ­¤æ¥ç¼©çŸ­æˆ‘ä»¬çš„å¼€å‘å‘¨æœŸå’Œæå‡è½¯ä»¶çš„è´¨é‡ã€‚</p>
</blockquote>
<p>æ ¹æ®å¸¸è¯†ï¼Œåªè¦ç¬¬ä¸‰æ–¹åº“çš„å¼€å‘è€…æŒ‰ç…§cocoapodsæŒ‡å®šçš„è§„èŒƒï¼ˆ<code>æˆªæ­¢å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œcocoapodså®˜ç½‘æ˜¾ç¤ºæœ‰3ä¸‡å¤šä¸ªç¬¬ä¸‰æ–¹åº“ä¸”æœ‰190å¤šä¸‡çš„appå¼•ç”¨äº†cocoapodsä¸­çš„è¿™äº›åº“ï¼ŒApp Storeå¹³å°ä¸Šçš„åº”ç”¨æ€»æ•°é‡æ˜¯300ä¸‡å·¦å³</code>ï¼‰è®¾è®¡ä»£ç åº“ï¼Œå°±å¯ä»¥æäº¤è‡³cocoapodsä»“åº“ï¼Œä¾›å…¨çƒå¼€å‘è€…ä»¬ä½¿ç”¨ã€‚ä½†æˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“åŸºæœ¬ä¸Šéƒ½æ˜¯å¼€æºåº“ï¼Œå¤§è‡´åŸç†å°±æ˜¯<code>pod install</code>ä¹‹åå°±æ˜¯æŠŠç¬¬ä¸‰æ–¹åº“çš„æºç ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åç¼–è¯‘æˆä¸€ä¸ªframeworkï¼Œappé“¾æ¥è¿™ä¸ªframeworkæ¥ä½¿ç”¨ã€‚</p>
<p>è€Œæˆ‘ä»¬æ˜¯ä¸€å®¶æä¾›SDKçš„é«˜ç§‘æŠ€å…¬å¸ï¼è€æ¿è¯´æˆ‘ä»¬æœ€å¤šåªèƒ½æŠŠäºŒè¿›åˆ¶æ”¾å‡ºå»ï¼ˆè€æ¿ï¼Œè¿äºŒè¿›åˆ¶éƒ½ä¸è®©æ”¾å‡ºå»ï¼Œä½ æ”¾æˆ‘å‡ºå»å§â€¦â€¦ï¼‰ï¼Œæºç ç»ä¸èƒ½æ”¾å‡ºå»ï¼è¯´å®è¯è¿˜åœ¨è¯•ç”¨æœŸçš„æˆ‘é¡¿æ—¶é™·å…¥äº†æ‡µé€¼çŠ¶æ€ï¼Œæ€ä¹ˆåŠå•Šï¼Ÿè¦ä¸ç›´æ¥æ”¾è‡ªå·±å‡ºå»å§ã€‚ã€‚ã€‚</p>
<p>é—®é¢˜æ€»æ˜¯è¦è§£å†³çš„ã€‚äºæ˜¯ä¸Šç½‘æœç´¢ï¼Œå¹³æ—¶å„ç§æ–¹æ¡ˆç»†èŠ‚ç»†åˆ°è®©äººæ„ŸåŠ¨çš„ç®€ä¹¦ã€çŸ¥ä¹è¿˜æœ‰stackflowä¸Šå°½ç„¶æ²¡æ‰¾åˆ°â€¦â€¦ğŸ˜¢ã€‚InfoQä¸Šæ‰¾åˆ°äº†å‚è€ƒé“¾æ¥åˆ—å‡ºçš„é‚£ç¯‡ä¸ºäº†æå‡ç¼–è¯‘é€Ÿåº¦å¯¹ç¬¬ä¸‰æ–¹podäºŒè¿›åˆ¶åŒ–çš„æ–‡ç« ã€‚</p>
<h3 id="å®ç°SDK"><a href="#å®ç°SDK" class="headerlink" title="å®ç°SDK"></a>å®ç°SDK</h3><p>çœ‹å®Œè‡³ä»”ç»†ä¸€æƒ³ï¼Œæˆ‘çš„äºŒè¿›åˆ¶ä¹Ÿæ˜¯ä¸€å †æºç ç¼–è¯‘å®Œçš„ï¼Œåªä¸è¿‡æ˜¯æå‰ç¼–è¯‘è€Œå·²å•Šï¼Œè¿™æ—¶æˆ‘åˆæƒ³èµ·äº†Bugtagsï¼Œä¸€ä¸ªé«˜çº§åŠŸèƒ½éœ€è¦ä»˜è´¹çš„bugç®¡ç†SDKï¼Œå®ƒçš„podå°±æ˜¯ä»¥frameworkæ–¹å¼æ‰“åŒ…çš„ã€‚åˆ«äººå¯ä»¥ï¼Œæˆ‘ä»¬æ²¡ç†ç”±ä¸è¡Œå•Šï¼åºŸè¯ä¸è¯´äº†ï¼Œå¼€æ’¸ï¼æ’¸ä¹‹å‰å…ˆçœ‹ä¸‹æ¸¸æˆè§„åˆ™ï¼š</p>
<blockquote>
<h4 id="æ ¸å¿ƒç»„ä»¶"><a href="#æ ¸å¿ƒç»„ä»¶" class="headerlink" title="æ ¸å¿ƒç»„ä»¶"></a>æ ¸å¿ƒç»„ä»¶</h4><p>Podfile</p>
<p>   Podfile æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œç”¨äºå®šä¹‰é¡¹ç›®æ‰€éœ€è¦ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“ã€‚è¯¥æ–‡ä»¶æ”¯æŒé«˜åº¦å®šåˆ¶ï¼Œä½ å¯ä»¥æ ¹æ®ä¸ªäººå–œå¥½å¯¹å…¶åšå‡ºå®šåˆ¶ã€‚æ›´å¤šç›¸å…³ä¿¡æ¯ï¼Œè¯·æŸ¥é˜… Podfile æŒ‡å—ã€‚</p>
<p>Podspec</p>
<p>.podspec ä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æè¿°äº†ä¸€ä¸ªåº“æ˜¯æ€æ ·è¢«æ·»åŠ åˆ°å·¥ç¨‹ä¸­çš„ã€‚å®ƒæ”¯æŒçš„åŠŸèƒ½æœ‰ï¼šåˆ—å‡ºæºæ–‡ä»¶ã€<code>frameworkã€ç¼–è¯‘é€‰é¡¹å’ŒæŸä¸ªåº“æ‰€éœ€è¦çš„ä¾èµ–</code>ç­‰ã€‚</p>
</blockquote>
<p>è¿™æ˜¯<a href="http://guides.cocoapods.org/syntax/podspec.html#specification" target="_blank" rel="external">guides.cocoapods</a>å®˜ç½‘.podspecæ¨¡æ¿ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">Pod::Spec.new do |spec|</div><div class="line">  spec.name         = &apos;Reachability&apos;</div><div class="line">  spec.version      = &apos;3.1.0&apos;</div><div class="line">  spec.license      = &#123; :type =&gt; &apos;BSD&apos; &#125;</div><div class="line">  spec.homepage     = &apos;https://github.com/tonymillion/Reachability&apos;</div><div class="line">  spec.authors      = &#123; &apos;Tony Million&apos; =&gt; &apos;tonymillion@gmail.com&apos; &#125;</div><div class="line">  spec.summary      = &apos;ARC and GCD Compatible Reachability Class for iOS and OS X.&apos;</div><div class="line">  spec.source       = &#123; :git =&gt; &apos;https://github.com/tonymillion/Reachability.git&apos;, :tag =&gt; &apos;v3.1.0&apos; &#125;</div><div class="line">  spec.module_name  = &apos;Rich&apos;</div><div class="line"></div><div class="line">  spec.ios.deployment_target  = &apos;9.0&apos;</div><div class="line">  spec.osx.deployment_target  = &apos;10.10&apos;</div><div class="line"></div><div class="line">  spec.source_files       = &apos;Reachability/common/*.swift&apos;</div><div class="line">  spec.ios.source_files   = &apos;Reachability/ios/*.swift&apos;, &apos;Reachability/extensions/*.swift&apos;</div><div class="line">  spec.osx.source_files   = &apos;Reachability/osx/*.swift&apos;</div><div class="line"></div><div class="line">  spec.framework      = &apos;SystemConfiguration&apos;</div><div class="line">  spec.ios.framework  = &apos;UIKit&apos;</div><div class="line">  spec.osx.framework  = &apos;AppKit&apos;</div><div class="line"></div><div class="line">  spec.dependency &apos;SomeOtherPod&apos;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>å‰é¢è¯´çš„Bugtagçš„Bugtags.podspecæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">Pod::Spec.new do |s|</div><div class="line">  s.name         = &quot;Bugtags&quot;</div><div class="line">  s.version      = &quot;2.2.2&quot;</div><div class="line">  s.summary      = &quot;Bug reporting for mobile apps, improve your app anytime, anywhere. Learn more at http://bugtags.com.&quot;</div><div class="line">  s.homepage     = &quot;http://bugtags.com/&quot;</div><div class="line">  s.license      = &#123;</div><div class="line">      :type =&gt; &apos;Commercial&apos;,</div><div class="line">      :text =&gt; &lt;&lt;-LICENSE</div><div class="line">                Copyright (C) 2017 Bugtags.</div><div class="line">                Permission is hereby granted to use this framework as is, modification are not allowed.</div><div class="line">                All rights reserved.</div><div class="line">        </div><div class="line">        THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</div><div class="line">        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</div><div class="line">        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</div><div class="line">        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</div><div class="line">        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</div><div class="line">        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</div><div class="line">        THE SOFTWARE.</div><div class="line">      LICENSE</div><div class="line">    &#125;</div><div class="line">  s.author              = &#123; &quot;Bugtags&quot; =&gt; &quot;dev@bugtags.com&quot; &#125;</div><div class="line">  s.platform            = :ios, &apos;6.0&apos;</div><div class="line">  s.source              = &#123; :git =&gt; &quot;https://github.com/bugtags/Bugtags-iOS.git&quot;, :tag =&gt; s.version.to_s &#125;</div><div class="line">  s.default_subspec     = &apos;Core&apos;</div><div class="line"></div><div class="line">  s.subspec &apos;Core&apos; do |ss|</div><div class="line">    ss.source_files        = &apos;Bugtags.framework/Versions/A/Headers/*.&#123;h&#125;&apos;</div><div class="line">    ss.resources           = &apos;Bugtags.bundle&apos;</div><div class="line">    ss.preserve_paths      = &apos;Bugtags.framework/*&apos;, &apos;Bugtags.bundle&apos;</div><div class="line">    ss.frameworks          = &apos;UIKit&apos;, &apos;ImageIO&apos;, &apos;AVFoundation&apos;, &apos;SystemConfiguration&apos;, &apos;CoreLocation&apos;, &apos;Security&apos;, &apos;CFNetwork&apos;, &apos;Bugtags&apos;</div><div class="line">    ss.libraries           = &apos;c++&apos;</div><div class="line">    ss.xcconfig            = &#123; &apos;FRAMEWORK_SEARCH_PATHS&apos; =&gt; &apos;&quot;$(PODS_ROOT)/Bugtags/&quot;&apos;, &apos;OTHER_LDFLAGS&apos; =&gt; &apos;-ObjC&apos; &#125;</div><div class="line">    ss.requires_arc        = true</div><div class="line">  end</div><div class="line"></div><div class="line">  s.subspec &apos;BugtagsInsta&apos; do |ss|</div><div class="line">    ss.dependency &apos;Bugtags/Core&apos;</div><div class="line">    ss.dependency &apos;BugtagsInsta&apos;</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>çœ‹å®ŒBugtags.podspecä¹‹åï¼Œæè¿‡cã€c++æˆ–è€…ç±»ä¼¼Qtçš„äººåº”è¯¥æœ‰ä¸€ç§ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰ï¼šè¿™ä¸å°±æ˜¯ä¸€ä¸ªmakefileå˜›ï¼Œå¯ä»¥æŒ‡å®šå‚ä¸ç¼–è¯‘çš„æºæ–‡ä»¶ï¼Œç¼–è¯‘é€‰é¡¹å’Œé“¾æ¥é€‰é¡¹ä»¥åŠæœ€ç»ˆäºŒè¿›åˆ¶æ–‡ä»¶æ”¯æŒçš„å¹³å°è¿™äº›å®šåˆ¶åŒ–çš„é…ç½®ï¼Œè¿™äº›é…ç½®ä¼šåœ¨<code>pod install</code>çš„æ—¶å€™å…¨éƒ¨å†™å…¥åˆ°xcodeçš„å·¥ç¨‹æ–‡ä»¶*.xcodeprojä¸­ã€‚<code>å¦ç™½çš„è¯´ï¼Œæˆ‘æ²¡æœ‰æŠŠpodspecæ–‡ä»¶æ”¯æŒçš„æ‰€æœ‰å‚æ•°éƒ½ä½“éªŒä¸€éï¼Œä½†åœ¨å®ç°å…¬å¸SDK podåŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„é…ç½®å…¨éƒ¨å¯ä»¥æ»¡è¶³ï¼Œä¾‹å¦‚-force_loadè¿™ç§ä¸€èˆ¬podå¾ˆå°‘ç”¨çš„é“¾æ¥é€‰é¡¹ã€‚</code></p>
<p>æŒ‰ç…§ä¸Šè¿°æ¨¡æ¿æˆ–è€…ä¸Š<a href="http://guides.cocoapods.org/syntax/podspec.html#subspec" target="_blank" rel="external">å®˜ç½‘</a>å’ŒgoogleåŸºæœ¬å¯ä»¥å®ç°è¿è¡Œåœ¨åˆ›å»ºpodçš„æ—¶å€™é»˜è®¤ç”Ÿæˆçš„demoã€‚ä½†æ˜¯è¿™æ ·è¿˜æ˜¯æ²¡æœ‰æ»¡è¶³å‘å¸ƒäºŒè¿›åˆ¶çš„éœ€æ±‚å•Šï¼æ˜¯çš„ï¼Œä¸Šé¢æ‰€è®²çš„æ˜¯æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„podspecï¼Œè¿™ä¸ªæ˜¯è¦æ”¾åˆ°å†…éƒ¨æºç ç®¡ç†å·¥å…·ä¸­çš„ï¼Œå¹³æ—¶å¼€å‘éƒ½æ˜¯åŸºäºè¿™ä¸ªæ–‡ä»¶é…ç½®xcodeç¯å¢ƒçš„ï¼Œæ‰€ä»¥æ˜¯è¦å…±äº«çš„ã€‚é‚£è¯´å¥½çš„å‘å¸ƒäºŒè¿›åˆ¶æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>ä¸‹é¢æ˜¯ä¸€å¼ appä½¿ç”¨podçš„ä¾èµ–å›¾ï¼ˆç‚¹å‡»çœ‹å¤§å›¾ï¼‰ï¼š</p>
<figure class="half"><br>    <a href="/images/pod.jpg"><img src="/images/pod.jpg" width="400" height="400"></a><br></figure>

<p>å…¶å®éƒ½åˆ°è¿™ä¸ªæ—¶å€™äº†ï¼Œåªè¦æŠŠå¼€å‘è¿‡ç¨‹ä¸­ç”Ÿæˆçš„product.frameworkå‘å¸ƒå‡ºå»å°±å¯ä»¥äº†ã€‚å…·ä½“æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿå…ˆè¯´ä¸‹æˆ‘ä»¬ï¼ˆæ­£å¸¸äººï¼‰å¹³æ—¶çš„å¼€å‘å’Œå‘å¸ƒæµç¨‹ï¼Œå¤§è‡´æ˜¯è¿™æ ·çš„ï¼Œå…¶ä»–äººæˆ‘ä¸æ¸…æ¥šï¼šäº§å“ç»ç†æˆ–è€…è€æ¿æè¦æ±‚ï¼ˆéœ€æ±‚ï¼šå®ç°ä¸€ä¸ªæ— äººé©¾é©¶é£æœºï¼Œä¸‹å‘¨ä¸€å‘å¸ƒï¼Œä¸å¯ä»¥è¢«æ‰“ä¸‹æ¥ï¼‰ï¼Œæˆ‘ä»¬ï¼ˆä»£ç å·¥ä½œè€…ï¼‰å®ç°ï¼ˆä¸€ä¸ªæ€ä¹ˆæ‰“éƒ½æ‰“ä¸ä¸‹æ¥çš„æ— äººé©¾é©¶é£æœºï¼‰ï¼Œå¼€å‘å®Œæˆå‘ç»™è€æ¿ï¼ˆè€æ¿è¦éªŒæ”¶ï¼Œç»“æœè€æ¿æ‰“äº†ä¸€ä¸ªé€šå®µéƒ½æ²¡æ‰“ä¸‹æ¥ï¼‰ï¼Œè€æ¿è¯´æˆ‘ä»¬çš„é£æœºå¯ä»¥å‘å¸ƒäº†ï¼Œæˆ‘ä»¬åšäº†å‘å¸ƒå‰çš„æ£€æŸ¥å’ŒéªŒè¯ï¼ˆæ“¦æ“¦é£æœºä¸Šçš„æ¶²ä½“ï¼ŒæŠšå¹³æœºç¿¼ä¸Šçš„çš±è¤¶ï¼‰ï¼Œå‘å°„ã€‚</p>
<p>å¤§è‡´æµç¨‹è¯´å®Œäº†ï¼Œå¼€å‘å®Œæˆï¼Œå‡†å¤‡å‘å¸ƒäº†ï¼ˆå¥½å¼€å¿ƒï¼‰ï¼æˆ‘å–œæ¬¢ç®€å•ç²—æš´çš„æ–¹å¼ï¼ˆå¤©ç”Ÿæ„šé’è¿˜æ²¡æœ‰æƒ³å‡ºæ›´å¥½çš„ï¼‰ï¼šæˆ‘å‡†å¤‡äº†ä¸¤ä»½podfileï¼šPodfile_devå’ŒPodfile_productï¼Œä¸¤ä»½podspecsï¼šTupuTech.podspec_devå’ŒTupuTech.podspec_productï¼Œå…·ä½“æ€ä¹ˆç”¨å‘¢ï¼Ÿæ€è·¯å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>å¼€å‘çš„æ—¶å€™ç”¨Podfile_devå’ŒTupuTech.podspec_devï¼Œdemoé€šè¿‡ç›¸å¯¹è·¯å¾„ä¾èµ–æœ¬åœ°å¼€å‘podï¼Œç¼–è¯‘demoã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬çš„podä¼šç¼–è¯‘æˆproduct.frameworkï¼Œè¿™ä¸ªframeworkå°±æ˜¯æˆ‘ä»¬éœ€è¦å‘å¸ƒçš„äºŒè¿›åˆ¶SDKã€‚<br>å‘å¸ƒçš„æ—¶å€™ç”¨Podfile_productå’ŒTupuTech.podspec_productï¼Œä¿®æ”¹podspecæ–‡ä»¶ä¾èµ–æºä»£ç æ”¹æˆæˆä¾èµ–framework</p>
</blockquote>
<p>Podfile_devæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">æ­£åœ¨åŠ è½½...</div></pre></td></tr></table></figure>
<p>TupuTech.podspec_devæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">æ­£åœ¨åŠ è½½...</div></pre></td></tr></table></figure>
<p>Podfile_productæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">æ­£åœ¨åŠ è½½...</div></pre></td></tr></table></figure>
<p>TupuTech.podspec_productæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">æ­£åœ¨åŠ è½½...</div></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™äº›æ–‡ä»¶æ ·å­æ˜¯ä»€ä¹ˆæ ·å¤§è‡´çŸ¥é“äº†ï¼Œä½†æ˜¯è¿™äº›æ–‡ä»¶æ˜¯ä»€ä¹ˆæ—¶å€™ç›¸äº’æ›¿æ¢çš„ï¼Ÿæ€ä¹ˆæ›¿æ¢çš„ï¼Ÿåƒè¿™ç§ç¹çæ˜“é”™çš„æ­¥éª¤æœ€å¥½ç»™å®ƒè„šæœ¬åŒ–ï¼Œç”¨è„šæœ¬æ¥åšäº‹æœ€å¥½çš„ï¼Œshellã€Pythonè¿™äº›å¹²è¿™äº›çœŸçš„å¤ªæ–¹ä¾¿äº†ï¼Œè„šæœ¬åŒ–ä¹‹ååœ¨å‡†å¤‡å¼€å‘æˆ–è€…å‘å¸ƒçš„æ—¶å€™åœ¨ä»£ç æ ¹ç›®å½•ä¸‹æ‰§è¡Œè¿™äº›è„šæœ¬ï¼Œè‡ªåŠ¨å¸®ä½ æŠŠè¿™äº›ç¯å¢ƒé…ç½®å¥½ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">#/bin/bash</div><div class="line"></div><div class="line">buildType=$1</div><div class="line">buildVersion=$2</div><div class="line"></div><div class="line">#æ›´æ–°podspecç‰ˆæœ¬å·</div><div class="line">if [ &quot;$buildType&quot; = &quot;product&quot; ]; then</div><div class="line">	echo &quot;product....&quot;</div><div class="line"></div><div class="line">	if [ ! $buildVersion ]; then</div><div class="line">	 echo &quot;è¯·è¾“å…¥éœ€è¦å‘å¸ƒçš„ç‰ˆæœ¬å·(eg:./build/build.sh product 1.5.0)&quot;</div><div class="line">	 exit</div><div class="line">	fi</div><div class="line"></div><div class="line">	#å°†ç‰ˆæœ¬å·æ›´æ–°è‡³å¯¹åº”çš„podspecå’Œpodfileæ–‡ä»¶ä¸­</div><div class="line">	python ./build/podspec.py ./build/podspecs/TupuTech.podspec_dev $buildVersion</div><div class="line">	python ./build/podspec.py ./build/podspecs/TupuTech.podspec_product $buildVersion</div><div class="line"></div><div class="line">	# python ./build/podfile.py ./build/podfiles/Podfile_dev $buildVersion</div><div class="line">	python ./build/podfile.py ./build/podfiles/Podfile_product $buildVersion</div><div class="line"></div><div class="line">	#ä¾èµ–é…ç½®</div><div class="line">	...</div><div class="line">	...</div><div class="line"></div><div class="line">	#copy dev podfileã€podspecè‡³å·¥ç¨‹ç›®å½•</div><div class="line">	cp build/podfiles/Podfile_dev tupu-iOS-demo/Podfile</div><div class="line">	cp build/podspecs/TupuTech.podspec_dev podspec/TupuTech.podspec</div><div class="line">	</div><div class="line">	#ä½¿ç”¨xcodeå‘½ä»¤è¡Œç¼–è¯‘å·¥å…·ç¼–è¯‘demoï¼Œé¡ºä¾¿ç”Ÿæˆæˆ‘ä»¬éœ€è¦å‘å¸ƒçš„frameworkè‡³æŒ‡å®šç›®å½•./Product</div><div class="line">	xcodebuild -workspace TuputechSDKDemo.xcworkspace -scheme TuputechSDKDemo -configuration Release -sdk iphonesimulator10.3  -derivedDataPath ./Product</div><div class="line">	xcodebuild -workspace TuputechSDKDemo.xcworkspace -scheme TuputechSDKDemo -configuration Release -sdk iphoneos10.3 -derivedDataPath ./Product</div><div class="line"> 	</div><div class="line">	cp -R Product/Build/Products/Release-iphoneos/TupuTech/TupuTech.framework Product</div><div class="line"></div><div class="line">	#åˆå¹¶çœŸæœºæŒ‡ä»¤é›†å’Œæ¨¡æ‹Ÿå™¨æŒ‡ä»¤é›†framework</div><div class="line">	lipo -output Product/TupuTech.framework/TupuTech -create Product/Build/Products/Release-iphoneos/TupuTech/TupuTech.framework/TupuTech Product/Build/Products/Release-iphonesimulator/TupuTech/TupuTech.framework/TupuTech</div><div class="line">	</div><div class="line">	#æ‹·è´è‡³å‘å¸ƒå‰éªŒè¯ç›®å½•</div><div class="line">	mkdir -p ../podspec/TupuTech/InnerFrameworks</div><div class="line">	cp -R Product/TupuTech.framework ../podspec/TupuTech/InnerFrameworks/</div><div class="line"></div><div class="line">	#ä½¿ç”¨Productç¯å¢ƒå’Œæ–°frameworkï¼Œç¼–è¯‘demoéªŒè¯framework</div><div class="line"> 	cd ../</div><div class="line"> 	cp build/podspecs/TupuTech.podspec_product podspec/TupuTech.podspec</div><div class="line"></div><div class="line">	echo &quot;Success: product....&quot;</div><div class="line">else	</div><div class="line">	echo &quot;dev....&quot;</div><div class="line">fi</div></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œpodspec/TupuTech/InnerFrameworks/TupuTech.frameworkå’Œpodspec/TupuTech.podspecå°±æ˜¯æˆ‘ä»¬éœ€è¦å‘å¸ƒçš„å†…å®¹ã€‚</p>
<p>SDKæ˜¯å¯ä»¥å‘å¸ƒäº†ï¼Œä»£ç åˆæ˜¯æ€ä¹ˆè·Ÿè¸ªç®¡ç†çš„å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“TupuTech.podspecæ–‡ä»¶æ˜¯è¦æäº¤è‡³Cocoapodsï¼Œdemoã€TupuTech.frameworéœ€è¦æäº¤è‡³ç±»ä¼¼githubè¿™ç§å…¬å¼€çš„ä»£ç ä»“åº“ä¸­ä¾›ç”¨æˆ·ä¸‹è½½çš„ï¼Œæºç éœ€è¦æ”¾åœ¨å…¬å¸å†…éƒ¨ä»£ç æœåŠ¡å™¨ä¸Šã€‚å¥½ä¹±æœ‰æœ¨æœ‰ï¼Ÿ<br>æ¥ä¸‹æ¥æˆ‘ä¼šå†åˆ†äº«ä¸€ä¸‹æ€ä¹ˆè§£å†³ä¸Šé¢è¿™ä¹ˆä¹±çš„ä»£ç è·Ÿè¸ªä»¥åŠä¸€ä¸ªé˜¿é‡Œå·´å·´å¼€æºçš„å«åšBeeHiveçš„åº“æ˜¯å¦‚ä½•åœ¨æˆ‘ä»¬SDKä¸­å‘æŒ¥å…¶æ„ä¹‰çš„ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‚è€ƒé“¾æ¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.infoq.com/cn/articles/cocoapods-binarization&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CocoaPodsç»„ä»¶å¹³æ»‘äºŒè¿›åˆ¶åŒ–è§£å†³æ–¹æ¡ˆ&lt;/a&gt;&lt;/
    
    </summary>
    
    
      <category term="iOS ç»„ä»¶åŒ–" scheme="http://antyme.com/tags/iOS-%E7%BB%84%E4%BB%B6%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸ç”¨æ•°æ®ç»“æ„ã€æ’åºç®—æ³•ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦</title>
    <link href="http://antyme.com/2016/12/23/%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%81%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E7%AE%97%E6%B3%95%E7%9A%84%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/"/>
    <id>http://antyme.com/2016/12/23/å¸¸ç”¨æ•°æ®ç»“æ„ã€æ’åºç®—æ³•ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦/</id>
    <published>2016-12-23T08:58:53.000Z</published>
    <updated>2016-12-23T09:17:40.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://blog.csdn.net/xiangzhihong8/article/details/51547835" target="_blank" rel="external">é˜…è¯»åŸæ–‡</a></p>
<p>è¿™ç¯‡æ˜¯åŸæ ·æŠ„è¿‡æ¥çš„ï¼Œä¸ºäº†è‡ªå·±åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å¯ä»¥éšæ—¶æŸ¥çœ‹å¹¶è¿…é€Ÿåšå‡ºé€‰æ‹©ï¼Œå¸Œæœ›åŸä½œè€…å¯ä»¥åŸè°…å“¦ï¼å¦‚æœéœ€è¦æ·±å…¥ä»£ç å­¦ä¹ ä¸åŒçš„æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œè¿˜æ˜¯ç‚¹å‡»åŸæ–‡å›å»çœ‹å§ï¼ŒåŸæ–‡æœ‰æ¯ä¸ªæ•°æ®ç»“æ„ã€ç®—æ³•å¯¹åº”çš„è¯¦è§£é“¾æ¥ã€‚</p>
<p>åœ¨æˆ‘ä»¬å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°æ¯”è¾ƒå¤šçš„åœºæ™¯å¹¶ä¸æ˜¯éœ€è¦è‡ªå·±é€ è¿™äº›è½®å­ï¼ˆç®—æ³•æˆ–è€…æ•°æ®ç»“æ„ï¼‰ï¼Œæ›´å¤šçš„æ˜¯éœ€è¦è‡ªå·±æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯(å†…å­˜å ç”¨é™åˆ¶ï¼Œé€Ÿåº¦è¦æ±‚)åšå‡ºé€‰æ‹©ï¼Œä¾‹å¦‚æ ¹æ®æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤å’Œéå†ç­‰ä¸åŒçš„ä½¿ç”¨é¢‘ç‡é€‰æ‹©ä¸åŒçš„æ•°æ®ç»“æ„ã€‚</p>
<h4 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h4><p><img src="http://oi7r83q55.bkt.clouddn.com/QQ20161223-2.png" alt=""></p>
<h4 id="æ’åºç®—æ³•"><a href="#æ’åºç®—æ³•" class="headerlink" title="æ’åºç®—æ³•"></a>æ’åºç®—æ³•</h4><p><img src="http://oi7r83q55.bkt.clouddn.com/QQ20161223-1.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/xiangzhihong8/article/details/51547835&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;é˜…è¯»åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ˜¯åŸæ ·æŠ„è¿‡æ¥çš„ï¼Œä¸ºäº†è‡ªå·±åœ¨ä½¿ç”¨çš„è¿‡ç¨‹
    
    </summary>
    
    
      <category term="ç®—æ³•/iOS/c/c++" scheme="http://antyme.com/tags/%E7%AE%97%E6%B3%95-iOS-c-c/"/>
    
  </entry>
  
  <entry>
    <title>iOS Blocksçš„å®ç°åŸç†</title>
    <link href="http://antyme.com/2016/12/18/iOS-Blocks%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/"/>
    <id>http://antyme.com/2016/12/18/iOS-Blocksçš„å®ç°åŸç†/</id>
    <published>2016-12-18T07:56:04.000Z</published>
    <updated>2016-12-23T09:19:03.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Blockçš„å®è´¨"><a href="#Blockçš„å®è´¨" class="headerlink" title="Blockçš„å®è´¨"></a>Blockçš„å®è´¨</h4><p>Blocks.mæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">int main() &#123;</div><div class="line">    void (^blk)() = ^&#123;</div><div class="line">//        printf(&quot;Hello Blocks&quot;);</div><div class="line">        int i = 0;</div><div class="line">        i = i + 1;</div><div class="line">    &#125;;</div><div class="line">    blk();</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨å‘½ä»¤è¡Œæ‰§è¡Œï¼š</p>
<blockquote>
<p>clang -rewrite-objc Blocks.m</p>
</blockquote>
<p>é€šè¿‡clang(LLVMç¼–è¯‘å™¨)å°†å«æœ‰Blockè¯­æ³•çš„æºä»£ç ï¼ˆBlocks.mï¼‰è½¬æ¢ä¸ºc++çš„æºä»£ç ï¼ˆBlocks.cppï¼‰ã€‚</p>
<p>Blocks.cppæ–‡ä»¶ï¼ˆæˆªå–è·Ÿç†è§£ç›¸å…³çš„ä»£ç ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">#ifndef BLOCK_IMPL</div><div class="line">#define BLOCK_IMPL</div><div class="line">struct __block_impl &#123;</div><div class="line">  void *isa;</div><div class="line">  int Flags;</div><div class="line">  int Reserved;</div><div class="line">  void *FuncPtr;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">struct __main_block_impl_0 &#123;</div><div class="line">  struct __block_impl impl;</div><div class="line">  struct __main_block_desc_0* Desc;</div><div class="line">  __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int flags=0) &#123;</div><div class="line">    impl.isa = &amp;_NSConcreteStackBlock;</div><div class="line">    impl.Flags = flags;</div><div class="line">    impl.FuncPtr = fp;</div><div class="line">    Desc = desc;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line">static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123;</div><div class="line"></div><div class="line"></div><div class="line">        int i = 0;</div><div class="line">        i = i + 1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">static struct __main_block_desc_0 &#123;</div><div class="line">  size_t reserved;</div><div class="line">  size_t Block_size;</div><div class="line">&#125; __main_block_desc_0_DATA = &#123; 0, sizeof(struct __main_block_impl_0)&#125;;</div><div class="line">int main() &#123;</div><div class="line">    void (*blk)() = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA));</div><div class="line">    ((void (*)(__block_impl *))((__block_impl *)blk)-&gt;FuncPtr)((__block_impl *)blk);</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è½¬æ¢ä¹‹åå°±æ˜¯æ­£å„¿å…«ç»çš„cè¯­è¨€ä»£ç äº†ï¼Œè¿™æŒ‡é’ˆï¼Œè¿™ç»“æ„ä½“ï¼Œè¿™å¸¦staticçš„æ–¹æ³•ï¼Œcè¯­è¨€çš„æ ‡é…å•Šï¼ğŸ˜</p>
<h4 id="Blockæ•è·å˜é‡ï¼ˆå±€éƒ¨å˜é‡ã€staticå˜é‡ã€-blockå˜é‡ï¼‰åŸç†"><a href="#Blockæ•è·å˜é‡ï¼ˆå±€éƒ¨å˜é‡ã€staticå˜é‡ã€-blockå˜é‡ï¼‰åŸç†" class="headerlink" title="Blockæ•è·å˜é‡ï¼ˆå±€éƒ¨å˜é‡ã€staticå˜é‡ã€__blockå˜é‡ï¼‰åŸç†"></a>Blockæ•è·å˜é‡ï¼ˆå±€éƒ¨å˜é‡ã€staticå˜é‡ã€__blockå˜é‡ï¼‰åŸç†</h4><p><code>æœªå®Œå¾…ç»­</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;Blockçš„å®è´¨&quot;&gt;&lt;a href=&quot;#Blockçš„å®è´¨&quot; class=&quot;headerlink&quot; title=&quot;Blockçš„å®è´¨&quot;&gt;&lt;/a&gt;Blockçš„å®è´¨&lt;/h4&gt;&lt;p&gt;Blocks.mæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain
    
    </summary>
    
    
      <category term="iOS/Objective-C" scheme="http://antyme.com/tags/iOS-Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>WebSocketåè®®ã€SocketRocketæºç å­¦ä¹ </title>
    <link href="http://antyme.com/2016/12/14/WebSocket%E5%8D%8F%E8%AE%AE-SocketRocket%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
    <id>http://antyme.com/2016/12/14/WebSocketåè®®-SocketRocketæºç å­¦ä¹ /</id>
    <published>2016-12-14T08:36:44.000Z</published>
    <updated>2016-12-15T09:23:53.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://tools.ietf.org/html/rfc6455#section-5.5.1" target="_blank" rel="external">rfc6455 WebSockets æ ‡å‡†</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/WebSockets/Writing_WebSocket_servers" target="_blank" rel="external">ç¼–å†™ WebSocket æœåŠ¡å™¨</a></p>
<h3 id="WebSocketæ¦‚è¿°ã€æ¡æ‰‹"><a href="#WebSocketæ¦‚è¿°ã€æ¡æ‰‹" class="headerlink" title="WebSocketæ¦‚è¿°ã€æ¡æ‰‹"></a>WebSocketæ¦‚è¿°ã€æ¡æ‰‹</h3><p>é¦–å…ˆï¼ŒæœåŠ¡å™¨å¿…é¡»é€šè¿‡æ ‡å‡† TCP å¥—æ¥å­—æ¥ä¾¦å¬å¤–æ¥çš„è¿æ¥è¯·æ±‚ã€‚å–å†³äºä½ çš„å¹³å°ï¼Œå¯èƒ½å·²ç»å¤„ç†å¥½æ¡æ‰‹äº†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å‡å®šä½ çš„æœåŠ¡ç›‘å¬åœ¨åœ°å€ example.com ï¼Œç«¯å£å· 8000 ä¸Šï¼Œè€Œä¸”èƒ½å¤Ÿå›åº”è·¯å¾„ /chat ä¸Šçš„ GET è¯·æ±‚ã€‚</p>
<blockquote>
<p>è­¦å‘Š: æœåŠ¡å™¨ç›‘å¬ä»»æ„æ‰€é€‰æ‹©çš„ç«¯å£ï¼Œä½†æ˜¯å¦‚æœåœ¨ 80 æˆ–è€… 443 ä¹‹å¤–çš„ç«¯å£ä¸Šï¼Œå¯èƒ½ä¼šåœ¨é˜²ç«å¢™æˆ–è€…ä»£ç†ä¸Šå‡ºé—®é¢˜ã€‚åœ¨ 443 ç«¯å£ä¸Šæ¯”è¾ƒå®¹æ˜“æˆåŠŸï¼Œä½†æ˜¯éœ€è¦å®‰å…¨è¿æ¥ï¼ˆTLS/SSLï¼‰ã€‚å¦å¤–å°±æ˜¯å¤§å¤šæ•°æµè§ˆå™¨ï¼ˆæ¯”å¦‚ Firefox 8+ï¼‰ä¸å…è®¸åœ¨å®‰å…¨é¡µé¢ä¸Šè¿æ¥ä¸å®‰å…¨çš„ WebSocket æœåŠ¡å™¨ã€‚</p>
</blockquote>
<p>æ¡æ‰‹è¿™ä¸€ç¯èŠ‚å°±æ˜¯ WebSockets ä¸Šçš„â€œwebâ€ã€‚å®ƒæ˜¯ä» HTTP åˆ° WS çš„æ¡¥æ¢ã€‚æ¡æ‰‹æ—¶ä¼šåå•†è¿æ¥çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶ä¸”å¦‚æœæ¡ä»¶ä¸é€‚åˆï¼Œä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥åœ¨æˆåŠŸå»ºç«‹è¿æ¥ä¹‹å‰é€€å‡ºã€‚æœåŠ¡å™¨ä¸€å®šè¦æ¸…æ¥šå®¢æˆ·ç«¯æ‰€è¦æ±‚çš„ä¸€åˆ‡ä¿¡æ¯ï¼Œå¦åˆ™å¯èƒ½ä¼šå‘ç”Ÿå®‰å…¨é—®é¢˜ã€‚</p>
<h5 id="å®¢æˆ·ç«¯æ¡æ‰‹è¯·æ±‚"><a href="#å®¢æˆ·ç«¯æ¡æ‰‹è¯·æ±‚" class="headerlink" title="å®¢æˆ·ç«¯æ¡æ‰‹è¯·æ±‚"></a>å®¢æˆ·ç«¯æ¡æ‰‹è¯·æ±‚</h5><p>å³ä½¿ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªæœåŠ¡ï¼ŒWebSocket æ¡æ‰‹è¯·æ±‚ä»éœ€è¦ç”±å®¢æˆ·ç«¯å‘èµ·ã€‚å› æ­¤ä½ å¿…é¡»çŸ¥é“å¦‚ä½•è§£è¯»å®¢æˆ·ç«¯ä¿¡æ¯ã€‚é¦–å…ˆå®¢æˆ·ç«¯ä¼šå‘é€ç±»ä¼¼è¿™æ ·çš„æ ‡å‡† HTTP è¯·æ±‚ï¼ˆHTTP ç‰ˆæœ¬å·æœ€ä½ä¸º 1.1 ï¼Œè€Œä¸”è¯·æ±‚æ–¹æ³•å¿…é¡»ä¸º GETï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">GET /chat HTTP/1.1</div><div class="line">Host: example.com:8000</div><div class="line">Upgrade: websocket</div><div class="line">Connection: Upgrade</div><div class="line">Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==</div><div class="line">Sec-WebSocket-Version: 13</div></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯å¯ä»¥è¯·æ±‚æ‰©å±•å’Œ/æˆ–å­åè®®åŒ–ï¼Œè¯¦è§<a href="https://developer.mozilla.org/zh-CN/docs/WebSockets/Writing_WebSocket_servers#Miscellaneous" target="_blank" rel="external">æ‚é¡¹</a>ã€‚å¦å¤–ï¼Œå¸¸è§„çš„å¤´éƒ¨ä¿¡æ¯å¦‚User-Agent,Referer, Cookie, or authentication ç­‰ä¹Ÿå¯èƒ½ä¼šå‡ºç°ã€‚ä½ å¯ä»¥éšæ„å¤„ç†è¿™äº›å†…å®¹ï¼Œå®ƒä»¬å¹¶ä¸ç›´æ¥å±äºWebScoketçš„ä¸€éƒ¨åˆ†ï¼Œå¿½ç•¥å®ƒä»¬ä¹Ÿæ²¡äº‹ã€‚åœ¨è®¸å¤šçš„å¸¸è§è®¾ç½®ä¸­ï¼Œåå‘ä»£ç†å·²ç»å¯¹å®ƒä»¬è¿›è¡Œäº†å¤„ç†ã€‚</p>
<p>å¦‚æœå­˜åœ¨ä»»ä½•æœªçŸ¥æˆ–è€…é”™è¯¯çš„è¯·æ±‚å¤´ï¼ŒæœåŠ¡å™¨åº”è¯¥å‘é€ä¸€ä¸ª <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#400" target="_blank" rel="external">â€œ400 Bad Requestâ€</a>å¹¶ç«‹å³å…³é—­ socketã€‚åƒå¾€å¸¸ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥åœ¨HTTPå“åº”ä½“ä¸­ç»™å‡ºæ¡æ‰‹å¤±è´¥çš„åŸå› ï¼Œä½†æ˜¯è¿™ä¸ªæ¶ˆæ¯å¯èƒ½ä»æ¥éƒ½ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ (æµè§ˆå™¨ä¸æ˜¾ç¤º)ã€‚ å¦‚æœæœåŠ¡å™¨æ— æ³•ç†è§£è¯·æ±‚çš„WebSocketsçš„ç‰ˆæœ¬ï¼Œå®ƒåº”è¯¥å‘é€ä¸€ä¸ªåŒ…å«å®ƒèƒ½ç†è§£çš„ç‰ˆæœ¬å·çš„Sec-WebSocket-Versionçš„å¤´éƒ¨ä¿¡æ¯ã€‚ (æœ¬æŒ‡å—è§£é‡Šäº†æœ€æ–°ç‰ˆæœ¬çš„v13)ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹æœ€è®©äººæœŸå¾…çš„å¤´éƒ¨ä¿¡æ¯ï¼ŒSec-WebSocket-Keyã€‚</p>
<blockquote>
<p><em>æç¤º: æ‰€æœ‰çš„æµè§ˆå™¨éƒ½ä¼šå‘é€ Origin è¯·æ±‚å¤´ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥å¤„ç†å®‰å…¨é—®é¢˜ï¼ˆæ¯”å¦‚é»‘åå•ï¼Œç™½åå•ï¼Œoriginæ£€æŸ¥ä¹‹ç±»çš„ï¼‰ç„¶åå‘é€å›å» 403 Forbidden æ¥ç¦æ­¢è¿æ¥ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œéæµè§ˆå™¨å®¢æˆ·ç«¯å¯ä»¥å‘é€ä¼ªé€ çš„ Originã€‚å¤§å¤šæ•°åº”ç”¨å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ° Origin è¯·æ±‚å¤´å°†ä¼šæ‹’ç»è¯·æ±‚ã€‚</em></p>
<p><em>æç¤º: è¯·æ±‚åœ°å€ (ä¾‹å¦‚è¿™é‡Œæ˜¯ /chat ) åœ¨è§„èŒƒä¸­æ²¡æœ‰æ˜ç¡®å®šä¹‰ã€‚æ‰€ä»¥è®¸å¤šäººå·§å¦™çš„åˆ©ç”¨è¿™ç‚¹ï¼Œè®©ä¸€ä¸ªæœåŠ¡å™¨å¤„ç†å¤šä¸ª WebSocket åº”ç”¨ã€‚ä¾‹å¦‚åœ¨ example.com/chat ä¸Šæ˜¯ä¸€ä¸ªèŠå¤©å®¤ï¼Œä¸æ­¤åŒæ—¶åœ¨ /game ä¸Šè¿è¡Œä¸€ä¸ªå¤šäººè”æœºæ¸¸æˆã€‚</em></p>
<p><em>æ³¨æ„: å¸¸è§„ HTTP çŠ¶æ€ç  åªèƒ½åœ¨æ¡æ‰‹å‰ä½¿ç”¨ã€‚æ¡æ‰‹æˆåŠŸåï¼Œä½ å°±å¾—ç”¨ä¸åŒçš„ä»£ç äº† (å‚é˜…è§„èŒƒçš„ç¬¬7ç« ç¬¬4èŠ‚ ).</em></p>
</blockquote>
<h5 id="æœåŠ¡å™¨æ¡æ‰‹å“åº”"><a href="#æœåŠ¡å™¨æ¡æ‰‹å“åº”" class="headerlink" title="æœåŠ¡å™¨æ¡æ‰‹å“åº”"></a>æœåŠ¡å™¨æ¡æ‰‹å“åº”</h5><p>æœåŠ¡å™¨æ”¶åˆ°æ¡æ‰‹è¯·æ±‚åï¼Œå°±åº”è¯¥å‘é€ä¸€ä¸ªçœ‹èµ·æ¥å¾ˆæ€ªå¼‚ (ä½†æ˜¯ä»ç„¶æ˜¯ HTTP ) çš„å“åº”ï¼Œå°±åƒè¿™æ ·ï¼š(è®°å¾—æ¯ä¸€ä¸ªå“åº”å¤´ä¹‹é—´ç”¨ \r\n é—´éš”ï¼Œæœ€åå†æ”¾ä¸€ä¸ª \r\n ç©ºè¡Œ)ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 101 Switching Protocols</div><div class="line">Upgrade: websocket</div><div class="line">Connection: Upgrade</div><div class="line">Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=</div></pre></td></tr></table></figure>
<p>æ­¤å¤–ï¼ŒæœåŠ¡å™¨åœ¨è¿™é‡Œä¹Ÿå¯ä»¥æŒ‡æ˜ æ‰©å±•/å­åè®®ï¼Œå…·ä½“å‚è€ƒ æ‚é¡¹ã€‚å…¶ä¸­çš„ Sec-WebSocket-Accept æ¯”è¾ƒæœ‰æ„æ€ã€‚è¦ç”Ÿæˆå®ƒï¼Œå°†å®¢æˆ·ç«¯æä¾›çš„ Sec-WebSocket-Key å’Œè§„å®šä¸­æŒ‡æ˜çš„ é­”æ³•å­—ç¬¦ä¸² â€œ258EAFA5-E914-47DA-95CA-C5AB0DC85B11â€ ç®€å•åœ°è¿åœ¨ä¸€èµ·ï¼Œè¿›è¡Œ SHA-1 Hashï¼Œç„¶åç”¨ base64 ç¼–ç ï¼Œè¿”å›ç»“æœå³å¯ã€‚</p>
<blockquote>
<p>ä»…ä¾›å‚è€ƒ: è¿™ä¸ªè¿‡ç¨‹å¯¹äºåˆ¤æ–­æœåŠ¡å™¨æ˜¯å¦æ”¯æŒWebSocketsè¿™ä¸ªå¾ˆæ˜æ˜¾çš„äº‹æƒ…æ¥è¯´å¯èƒ½æ˜¾å¾—å¤ªè¿‡å¤æ‚ã€‚ä½†æ˜¯ï¼Œè¿™éå¸¸é‡è¦ï¼Œå¦‚æœæœåŠ¡å™¨æ¥å—äº†ä¸€ä¸ªWebSocketsçš„é“¾æ¥å´æŒ‰ç…§HTTPè¯·æ±‚æ¥è§£æå¯èƒ½ä¼šå¸¦æ¥å®‰å…¨ä¸Šçš„é—®é¢˜ã€‚</p>
</blockquote>
<p>æ‰€ä»¥å‡è®¾å®¢æˆ·ç«¯å‘æ¥çš„æ˜¯ â€œdGhlIHNhbXBsZSBub25jZQ==â€ï¼ŒæœåŠ¡å™¨å°±å›å¤ â€œs3pPLMBiTxaQ9kYGzzhZRbK+xOo=â€ã€‚ä¸€æ—¦æœåŠ¡å™¨å‘é€å®Œè¿™äº›å“åº”å¤´ï¼Œè¿æ¥å°±å»ºç«‹äº†ï¼Œå¯ä»¥å¼€å§‹äº¤æ¢æ•°æ®äº†ã€‚</p>
<blockquote>
<p>å½“ç„¶æœåŠ¡å™¨ä¹Ÿå¯ä»¥å‘é€ Set-Cookie ä¹‹ç±»çš„å¤´ï¼Œæˆ–è€…å…³äºè®¤è¯çš„è¯·æ±‚ï¼Œæˆ–è€…é€šè¿‡å…¶ä»–çŠ¶æ€ç é‡å®šå‘ï¼Œæ€»ä¹‹åªè¦åœ¨æ¡æ‰‹å“åº”ä¿¡æ¯å‘å‡ºä¹‹å‰éƒ½å¯ä»¥ã€‚</p>
</blockquote>
<h5 id="æŒç»­è¿½è¸ªå®¢æˆ·ç«¯"><a href="#æŒç»­è¿½è¸ªå®¢æˆ·ç«¯" class="headerlink" title="æŒç»­è¿½è¸ªå®¢æˆ·ç«¯"></a>æŒç»­è¿½è¸ªå®¢æˆ·ç«¯</h5><p>è¿™éƒ¨åˆ†å’ŒWebsocketåè®®æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œä½†è¯·åŠ¡å¿…æ³¨æ„ï¼šä½ çš„æœåŠ¡å™¨å¿…é¡»æŒç»­è¿½è¸ªæ¯ä¸ªå®¢æˆ·ç«¯çš„socketä»¥é¿å…è¿›è¡Œé‡å¤çš„æ¡æ‰‹ã€‚åŒä¸€ä¸ªå®¢æˆ·IPåœ°å€å¯èƒ½å°è¯•è¿æ¥å¤šæ¬¡ï¼ˆä½†æœåŠ¡å™¨ä¸ºä¿æŠ¤è‡ªå·±å…å—DoSæ‹’ç»æœåŠ¡å¼æ”»å‡»ï¼Œä¹Ÿå¯æ‹’ç»é‚£äº›è¿‡å¤šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼‰ã€‚</p>
<h3 id="WebSocketåè®®"><a href="#WebSocketåè®®" class="headerlink" title="WebSocketåè®®"></a>WebSocketåè®®</h3><blockquote>
<p>æˆ‘ä»¬çŸ¥é“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½èƒ½åœ¨ä»»æ„æ—¶å€™å‘é€æ•°æ®â€”â€”è¿™æ˜¯WebSocketçš„ç¥å¥‡ä¹‹å¤„ï¼Œè€Œä¸”ä¸ç®¡æ•°æ®æ˜¯ä»å®¢æˆ·ç«¯-&gt;æœåŠ¡ç«¯ï¼Œè¿˜æ˜¯ä»æœåŠ¡ç«¯-&gt;å®¢æˆ·ç«¯ï¼Œæ¯ä¸ªæ•°æ®å¸§ï¼ˆåŒ…ï¼‰çš„æ ¼å¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">0                   1                   2                   3</div><div class="line"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</div><div class="line">+-+-+-+-+-------+-+-------------+-------------------------------+</div><div class="line">|F|R|R|R| opcode|M| Payload len |    Extended payload length    |</div><div class="line">|I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |</div><div class="line">|N|V|V|V|       |S|             |   (if payload len==126/127)   |</div><div class="line">| |1|2|3|       |K|             |                               |</div><div class="line">+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +</div><div class="line">|     Extended payload length continued, if payload len == 127  |</div><div class="line">+ - - - - - - - - - - - - - - - +-------------------------------+</div><div class="line">|                               |Masking-key, if MASK set to 1  |</div><div class="line">+-------------------------------+-------------------------------+</div><div class="line">| Masking-key (continued)       |          Payload Data         |</div><div class="line">+-------------------------------- - - - - - - - - - - - - - - - +</div><div class="line">:                     Payload Data continued ...                :</div><div class="line">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</div><div class="line">|                     Payload Data continued ...                |</div><div class="line">+---------------------------------------------------------------+</div><div class="line"></div><div class="line">		websocketåè®®ï¼ˆæ•°æ®å¸§æ ¼å¼ï¼‰</div></pre></td></tr></table></figure>
<blockquote>
<p>1ã€å­—æ®µFINï¼šFIN ä½å’Œæ“ä½œç å­—æ®µå…±åŒèµ·åˆ°æŠŠä¸€ä¸ªæŠ¥æ–‡åˆ†æˆå‡ ä¸ªæ•°æ®å¸§å‘é€çš„ä½œç”¨ã€‚è¿™å°±å«åšæŠ¥æ–‡åˆ†æ®µï¼Œåˆ†æ®µåªåœ¨æ“ä½œç ä¸º 0x0ã€0x1ã€0x2 æ—¶æœ‰æ•ˆã€‚ä¸‹é¢demo-1è¯¦ç»†ä»‹ç»å…¶ç”¨æ³•ã€‚</p>
<p>2ã€å­—æ®µRSV1ã€RSV2ã€RSV3å¯å¿½ç•¥ï¼Œé‚£æ˜¯ç”¨äºæ‰©å±•çš„ä¿ç•™å­—æ®µã€‚</p>
<p>3ã€å­—æ®µopcodeï¼šæ“ä½œç (opcode) å­—æ®µå®šä¹‰æ€æ ·è§£é‡Šè´Ÿè½½æ•°æ®ï¼š å­—æ®µå®šä¹‰äº†å¦‚ä½•è§£é‡Šæœ‰æ•ˆè´Ÿè½½æ•°æ®:  0x0 ä¸ºç»§ç»­ï¼Œ0x1 æ–‡æœ¬ (ä»¥ utf-8 ç¼–ç )ï¼Œ0x2 ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼Œå’Œåé¢å°†è¦è®¨è®ºçš„å…¶ä»–æ‰€è°“â€æ§åˆ¶ä»£ç â€ã€‚åœ¨æ­¤ç‰ˆæœ¬çš„ Websocketï¼ˆå½“å‰ç‰ˆæœ¬å·ä¸º13ï¼‰ï¼Œ0x3 åˆ° 0x7 å’Œ 0xB åˆ° 0xF æ— æ„ä¹‰ã€‚<br><br></p>
<ul>
<li>0x00ï¼šè¡¨ç¤ºè¿™å¸§æ˜¯è¿ç»­çš„å¸§ï¼Œåº”è¯¥æŠŠè¿™å¸§çš„è´Ÿè½½æ•°æ®è¿æ¥åˆ°æ¥æ”¶çš„ä¸Šä¸€å¸§ï¼Œä¸‹é¢demo1æè¿°äº†å…·ä½“çš„ç”¨æ³•ã€‚<br><br></li>
<li>0x01ï¼šè´Ÿè½½æ•°æ®æ˜¯æ–‡æœ¬ã€‚<br><br></li>
<li>0x02ï¼šè´Ÿè½½æ•°æ®æ˜¯äºŒè¿›åˆ¶æ•°æ®ã€‚<br><br></li>
<li>0x08ï¼šå…³é—­è¿æ¥çš„è¯·æ±‚å¸§ï¼Œè¦å…³é—­ä¸€ä¸ªè¿æ¥çš„è¯ï¼Œå®¢æˆ·ç«¯æˆ–è€…æœåŠ¡ç«¯å¯ä»¥å‘é€ä¸€ä¸ªå¸¦æœ‰ä¸€æ®µç‰¹æ®Šæ§åˆ¶åºåˆ—æ•°æ®çš„æ§åˆ¶å¸§ï¼Œæ¥å¼€å§‹æŒ¥æ‰‹è¿‡ç¨‹ã€‚ä¸€æ—¦æ¥æ”¶åˆ°è¿™æ ·çš„å¸§ï¼Œå¦ä¸€æ–¹å‘é€å…³é—­å¸§ä½œä¸ºå›åº”ã€‚ä»»ä½•å…³é—­è¿æ¥ä¹‹åçš„æ•°æ®å°†è¢«åºŸå¼ƒã€‚ï¼ˆæˆ‘åœ¨è°ƒè¯•çš„æ—¶å€™è¿™ä¸ªå€¼ç­‰äºâ€™\bâ€™ï¼ŒçŸ¥é“ä¸ºä»€ä¹ˆå—ğŸ˜ï¼‰<br><br></li>
<li>0x9ï¼šPingåŒ…ï¼Œåœ¨æ¡æ‰‹åçš„ä»»ä½•ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œå®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨å¯ä»¥é€‰æ‹©å‘é€ä¸€ä¸ªpingåŒ…ç»™å¯¹æ–¹ã€‚<br> <br></li>
<li>0xAï¼šPongåŒ…ï¼Œå½“pingåŒ…è¢«æ”¶åˆ°æ—¶ï¼Œæ¥å—è€…å¿…é¡»å°½å¯èƒ½å¿«çš„å‘å›pongåŒ…ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªæœºåˆ¶æ¥ç¡®å®šå®¢æˆ·ç«¯ä»ç„¶å¤„äºè¿æ¥çŠ¶æ€ã€‚</li>
</ul>
<p>4ã€å­—æ®µMASKï¼šMASKå­—æ®µè¡¨æ˜æŠ¥æ–‡æ˜¯å¦è¢«ç¼–ç ï¼ˆæŒ‰ï¼šå³å‰è¿°XORå¼‚æˆ–åŠ å¯†ï¼‰ã€‚å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯åº”è¯¥è¢«æ©è”½ï¼Œæ‰€ä»¥ä½ çš„æœåŠ¡å™¨åº”è¯¥æœŸå¾…è¿™ä¸ªä½ä¸º1ã€‚ï¼ˆäº‹å®ä¸Šï¼Œ<a href="https://tools.ietf.org/html/rfc6455#section-5.1èŠ‚" target="_blank" rel="external">rfc6455 websocketè§„èŒƒçš„5.1</a>è¯´å¦‚å®¢æˆ·ç«¯å‘æ¥â€œæœªæ©è”½â€çš„æŠ¥æ–‡é‚£æœåŠ¡ç«¯åº”è¯¥æ–­å¼€è¿™ä¸ªè¿æ¥ã€‚ï¼‰æœåŠ¡ç«¯å›æŠ¥æ–‡ç»™å®¢æˆ·ç«¯åˆ™ä¸è¦æ©è”½æ•°æ®ï¼Œç›¸åº”çš„MASKä½ä¸º0ã€‚ç¨åæˆ‘ä»¬å°†è§£é‡Šæ©è”½ã€‚æ³¨æ„ï¼šå³ä½¿åœ¨ä¸€ä¸ªå®‰å…¨å¥—æ¥å­—ä¸Šä¼ è¾“æ•°æ®ï¼Œä¹Ÿè¦éµå®ˆä¸Šè¿°è§„åˆ™ã€‚</p>
<p>5ã€å­—æ®µPayload lenï¼ˆ9-15ä½ï¼‰ï¼šè¯»å–è´Ÿè½½æ•°æ®ï¼Œéœ€è¦çŸ¥é“è¯»åˆ°é‚£é‡Œä¸ºæ­¢ã€‚å› æ­¤è·çŸ¥è´Ÿè½½æ•°æ®é•¿åº¦å¾ˆé‡è¦ã€‚è¿™ä¸ªè¿‡ç¨‹ç¨å¾®æœ‰ç‚¹å¤æ‚ï¼Œè¦ä»¥ä¸‹è¿™äº›æ­¥éª¤ï¼š</p>
<ul>
<li>è¯»å–9-15ä½ (åŒ…æ‹¬9å’Œ15ä½æœ¬èº«)ï¼Œå¹¶è½¬æ¢ä¸ºæ— ç¬¦å·æ•´æ•°ã€‚å¦‚æœå€¼å°äºæˆ–ç­‰äº125ï¼Œè¿™ä¸ªå€¼å°±æ˜¯é•¿åº¦ï¼›å¦‚æœæ˜¯ 126ï¼Œè¯·è½¬åˆ°æ­¥éª¤ 2ã€‚å¦‚æœå®ƒæ˜¯ 127ï¼Œè¯·è½¬åˆ°æ­¥éª¤ 3ã€‚</li>
<li>è¯»å–æ¥ä¸‹æ¥çš„ 16 ä½å¹¶è½¬æ¢ä¸ºæ— ç¬¦å·æ•´æ•°ï¼Œå¹¶ä½œä¸ºé•¿åº¦ã€‚</li>
<li>è¯»å–æ¥ä¸‹æ¥çš„ 64 ä½å¹¶è½¬æ¢ä¸ºæ— ç¬¦å·æ•´æ•° (æœ€é«˜æœ‰æ•ˆä½å¿…é¡»ä¸º0)ï¼Œå¹¶ä½œä¸ºé•¿åº¦ã€‚</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Client: FIN=1, opcode=0x1, msg=&quot;hello&quot;</div><div class="line">Server: (process complete message immediately) Hi.</div><div class="line">Client: FIN=0, opcode=0x1, msg=&quot;and a&quot;</div><div class="line">Server: (listening, new message containing text started)</div><div class="line">Client: FIN=0, opcode=0x0, msg=&quot;happy new&quot;</div><div class="line">Server: (listening, payload concatenated to previous message)</div><div class="line">Client: FIN=1, opcode=0x0, msg=&quot;year!&quot;</div><div class="line">Server: (process complete message) Happy new year to you too!</div><div class="line"></div><div class="line">				demo-1</div></pre></td></tr></table></figure>
<p>demo-1æè¿°æœåŠ¡å™¨å¦‚ä½•å›åº”å®¢æˆ·ç«¯å‘é€çš„æ–‡æœ¬æ•°æ®ã€‚ç¬¬ä¸€ä¸ªæŠ¥æ–‡å‘é€äº†å•ä¸ªæ•°æ®å¸§ï¼Œè€Œç¬¬äºŒä¸ªæŠ¥æ–‡é€šè¿‡ä¸‰å¸§å‘é€ã€‚</p>
<h3 id="WebSocket-iOSå¼€æºåº“SocketRocketæºç å­¦ä¹ ï¼ˆfacebookï¼‰"><a href="#WebSocket-iOSå¼€æºåº“SocketRocketæºç å­¦ä¹ ï¼ˆfacebookï¼‰" class="headerlink" title="WebSocket iOSå¼€æºåº“SocketRocketæºç å­¦ä¹ ï¼ˆfacebookï¼‰"></a>WebSocket iOSå¼€æºåº“SocketRocketæºç å­¦ä¹ ï¼ˆ<a href="https://github.com/facebook/SocketRocket" target="_blank" rel="external">facebook</a>ï¼‰</h3><p>æ‰€æœ‰å­¦ä¹ æ–¹æ³•ä¸­æœ‰ä¸€æ¡æ¯”è¾ƒé«˜æ•ˆçš„å°±æ˜¯ç†è®ºè”ç³»å®é™…ï¼ˆä»£ç ï¼‰ã€‚iOSå¼€å‘ä¸­ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯websocketåº“æ˜¯Socket.IO-Client-Swiftå’ŒFacebookå¼€æºçš„SocketRocketï¼Œåˆšå¼€å§‹å‡†å¤‡ç ”ç©¶å­¦ä¹ ç¬¬ä¸€ä¸ªï¼Œå‘ç°Socket.IO-Clientä¸æˆ‘ä»¬è‡ªå·±æœåŠ¡ç«¯æä¾›çš„æ¥å£é€‚é…æœ‰ç‚¹é—®é¢˜ï¼Œè€Œä¸”çœ‹äº†ä¸‹æºä»£ç ï¼Œé»˜è®¤ä¼šåœ¨pathåé¢å¼ºåˆ¶æ’å…¥â€™/â€˜ï¼Œè€Œä¸”è¯·æ±‚çš„pathä¹Ÿä¼šå¼ºåˆ¶å¤„ç†ï¼Œæ²¡æœ‰æä¾›è‡ªå®šä¹‰çš„æœºä¼šï¼Œæäº†ä¸€ä¸Šåˆéƒ½è¿ä¸ä¸Šã€‚åœ¨ç»§ç»­ä¹‹å‰å°è¯•äº†ä¸€ä¸‹SocketRocketï¼Œå“‡å¡ï¼Œä¸è¦å¤ªçˆ½ï¼Œä¸æ„§æ˜¯Facebookå•Šï¼äºæ˜¯ç«‹å³â€œæ‚¬å´–å‹’é©¬â€ï¼Œç”¨è¿™ç¯‡æ–‡ç« è®°å½•ä¸‹è‡ªå·±çš„æ”¶è·å’Œç†è§£ã€‚</p>
<p>ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ¥è‡ªäºSocketRocketæºç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">- (void)_initializeStreams;</div><div class="line">&#123;</div><div class="line">    assert(_url.port.unsignedIntValue &lt;= UINT32_MAX);</div><div class="line">    uint32_t port = _url.port.unsignedIntValue;</div><div class="line">    if (port == 0) &#123;</div><div class="line">        if (!_secure) &#123;</div><div class="line">            port = 80;</div><div class="line">        &#125; else &#123;</div><div class="line">            port = 443;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    NSString *host = _url.host;</div><div class="line">    </div><div class="line">    CFReadStreamRef readStream = NULL;</div><div class="line">    CFWriteStreamRef writeStream = NULL;</div><div class="line">    </div><div class="line">    CFStreamCreatePairWithSocketToHost(NULL, (__bridge CFStringRef)host, port, &amp;readStream, &amp;writeStream);//åˆ›å»ºäº†socketé€šä¿¡çš„è¾“å…¥å’Œè¾“å‡ºæµ</div><div class="line">    </div><div class="line">    _outputStream = CFBridgingRelease(writeStream);</div><div class="line">    _inputStream = CFBridgingRelease(readStream);</div><div class="line">    </div><div class="line">    //@protocol NSStreamDelegate &lt;NSObject&gt;</div><div class="line">	//	@optional</div><div class="line">	//	- (void)stream:(NSStream *)aStream handleEvent:(NSStreamEvent)eventCode;</div><div class="line">	// @end</div><div class="line">    _inputStream.delegate = self;</div><div class="line">    _outputStream.delegate = self;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>_initializeStreamsæ–¹æ³•åˆ›å»ºäº†socketé€šä¿¡çš„è¾“å…¥å’Œè¾“å‡ºstreamã€‚ä½†æ˜¯ï¼Œè¯·çœ‹Appleæ–‡æ¡£å¯¹CFStreamCreatePairWithSocketToHostæ–¹æ³•çš„è¯´æ˜ï¼Œå¾ˆé‡è¦ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Creates readable and writable streams connected to a TCP/IP port of a particular host.</div><div class="line">The streams do not create a socket, resolve the hostname, or connect to the remote host until you open one of the streams.</div><div class="line">Most properties are shared by both streams. Setting a shared property for one stream automatically sets the property for the other.</div></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘å¤§è‡´ç¿»è¯‘ä¸€ä¸‹ï¼ˆå°´å°¬ï¼‰ï¼šè¿™ä¸ªæ–¹æ³•åœ¨æœ¬æœºä¸ä½¿ç”¨TCP/IPç«¯å£çš„å¯¹æ–¹ä¸»æœºä¹‹é—´ä»…ä»…åˆ›å»ºäº†ç”¨æ¥å†™å…¥å’Œè¯»å–æ•°æ®çš„ä¸¤ä¸ªæµã€‚ä½†æ˜¯è¿™äº›æµå¹¶æ²¡æœ‰åˆ›å»ºçœŸæ­£çš„socketï¼Œæ²¡æœ‰å¼€å§‹è§£æè¿™ä¸ªhostï¼Œä¹Ÿæ²¡æœ‰å¼€å§‹è¿æ¥å¯¹æ–¹ä¸»æœºï¼Œä¸Šè¿°è¿™äº›æ“ä½œä¼šåœ¨è°ƒç”¨opençš„æ—¶å€™æ‰§è¡Œã€‚è¿™ä¸¤ä¸ªæµä¼šå…±äº«å¤§å¤šæ•°çš„å±æ€§ã€‚åªè¦ä¿®æ”¹çš„å±æ€§æ°å¥½æ˜¯å®ƒä»¬å…±äº«çš„ï¼Œåœ¨å®ƒä»¬ä»»ä½•ä¸€ä¸ªä¸­è¿›è¡Œä¿®æ”¹ï¼Œéƒ½ä¼šè‡ªåŠ¨æŠŠè¯¥å±æ€§ä¿®æ”¹ä¹‹åçš„å€¼åŒæ­¥ç»™å¦å¤–ä¸€æ–¹ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (void)openConnection;</div><div class="line">&#123;</div><div class="line">    [self _updateSecureStreamOptions];</div><div class="line">    </div><div class="line">    if (!_scheduledRunloops.count) &#123;</div><div class="line">        [self scheduleInRunLoop:[NSRunLoop SR_networkRunLoop] forMode:NSDefaultRunLoopMode];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    [_outputStream open];</div><div class="line">    [_inputStream open];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™æ®µä»£ç æ‰å¼€å§‹è¿›è¡ŒçœŸæ­£çš„è¿æ¥ã€‚</p>
<p>ä¸‹é¢è¿™æ®µæ˜¯Appleæ–‡æ¡£å¯¹NSStreamDelegateçš„æè¿°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@protocol NSStreamDelegate &lt;NSObject&gt;</div><div class="line">@optional</div><div class="line">- (void)stream:(NSStream *)aStream handleEvent:(NSStreamEvent)eventCode;</div><div class="line">@end</div></pre></td></tr></table></figure>
<blockquote>
<p>The delegate receives this message when a given event has occurred on a given stream.<br>The delegate receives this message only if theStream is scheduled on a run loop. The message is sent on the stream objectâ€™s thread. The delegate should examine streamEvent to determine the appropriate action it should take.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">- (void)stream:(NSStream *)aStream handleEvent:(NSStreamEvent)eventCode;</div><div class="line">&#123;</div><div class="line">	...</div><div class="line">    [weakSelf safeHandleEvent:eventCode stream:aStream];</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)safeHandleEvent:(NSStreamEvent)eventCode stream:(NSStream *)aStream</div><div class="line">&#123;</div><div class="line">        switch (eventCode) &#123;</div><div class="line">            case NSStreamEventOpenCompleted: &#123;</div><div class="line">	            ...</div><div class="line">	            ...</div><div class="line">	            [self didConnect];</div><div class="line">	            ...</div><div class="line">                [self _pumpWriting];</div><div class="line">                [self _pumpScanner];</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">                </div><div class="line">            case NSStreamEventErrorOccurred: &#123;</div><div class="line">	            ...</div><div class="line">	            ...</div><div class="line">                break;                </div><div class="line">            &#125;</div><div class="line">                </div><div class="line">            case NSStreamEventEndEncountered: &#123;</div><div class="line">                [self _pumpScanner];</div><div class="line">                ...</div><div class="line">                ...</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">                </div><div class="line">            case NSStreamEventHasBytesAvailable: &#123;</div><div class="line">                ...</div><div class="line">                ...</div><div class="line">                [self _pumpScanner];</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">                </div><div class="line">            case NSStreamEventHasSpaceAvailable: &#123;</div><div class="line">	            ...</div><div class="line">	            ...</div><div class="line">                [self _pumpWriting];</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">                </div><div class="line">            default:</div><div class="line">                SRFastLog(@&quot;(default)  %@&quot;, aStream);</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">- (void)didConnect;</div><div class="line">&#123;</div><div class="line">    SRFastLog(@&quot;Connected&quot;);</div><div class="line">    CFHTTPMessageRef request = CFHTTPMessageCreateRequest(NULL, CFSTR(&quot;GET&quot;), (__bridge CFURLRef)_url, kCFHTTPVersion1_1);</div><div class="line">    </div><div class="line">    // Set host first so it defaults</div><div class="line">    CFHTTPMessageSetHeaderFieldValue(request, CFSTR(&quot;Host&quot;), (__bridge CFStringRef)(_url.port ? [NSString stringWithFormat:@&quot;%@:%@&quot;, _url.host, _url.port] : _url.host));</div><div class="line">        </div><div class="line">    NSMutableData *keyBytes = [[NSMutableData alloc] initWithLength:16];</div><div class="line">    SecRandomCopyBytes(kSecRandomDefault, keyBytes.length, keyBytes.mutableBytes);</div><div class="line">    </div><div class="line">    if ([keyBytes respondsToSelector:@selector(base64EncodedStringWithOptions:)]) &#123;</div><div class="line">        _secKey = [keyBytes base64EncodedStringWithOptions:0];</div><div class="line">    &#125; else &#123;</div><div class="line">#pragma clang diagnostic push</div><div class="line">#pragma clang diagnostic ignored &quot;-Wdeprecated-declarations&quot;</div><div class="line">        _secKey = [keyBytes base64Encoding];</div><div class="line">#pragma clang diagnostic pop</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    assert([_secKey length] == 24);</div><div class="line"></div><div class="line">    // Apply cookies if any have been provided</div><div class="line">    NSDictionary * cookies = [NSHTTPCookie requestHeaderFieldsWithCookies:[self requestCookies]];</div><div class="line">    for (NSString * cookieKey in cookies) &#123;</div><div class="line">        NSString * cookieValue = [cookies objectForKey:cookieKey];</div><div class="line">        if ([cookieKey length] &amp;&amp; [cookieValue length]) &#123;</div><div class="line">            CFHTTPMessageSetHeaderFieldValue(request, (__bridge CFStringRef)cookieKey, (__bridge CFStringRef)cookieValue);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    // set header for http basic auth</div><div class="line">    if (_url.user.length &amp;&amp; _url.password.length) &#123;</div><div class="line">        NSData *userAndPassword = [[NSString stringWithFormat:@&quot;%@:%@&quot;, _url.user, _url.password] dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line">        NSString *userAndPasswordBase64Encoded;</div><div class="line">        if ([keyBytes respondsToSelector:@selector(base64EncodedStringWithOptions:)]) &#123;</div><div class="line">            userAndPasswordBase64Encoded = [userAndPassword base64EncodedStringWithOptions:0];</div><div class="line">        &#125; else &#123;</div><div class="line">#pragma clang diagnostic push</div><div class="line">#pragma clang diagnostic ignored &quot;-Wdeprecated-declarations&quot;</div><div class="line">            userAndPasswordBase64Encoded = [userAndPassword base64Encoding];</div><div class="line">#pragma clang diagnostic pop</div><div class="line">        &#125;</div><div class="line">        _basicAuthorizationString = [NSString stringWithFormat:@&quot;Basic %@&quot;, userAndPasswordBase64Encoded];</div><div class="line">        CFHTTPMessageSetHeaderFieldValue(request, CFSTR(&quot;Authorization&quot;), (__bridge CFStringRef)_basicAuthorizationString);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    CFHTTPMessageSetHeaderFieldValue(request, CFSTR(&quot;Upgrade&quot;), CFSTR(&quot;websocket&quot;));</div><div class="line">    CFHTTPMessageSetHeaderFieldValue(request, CFSTR(&quot;Connection&quot;), CFSTR(&quot;Upgrade&quot;));</div><div class="line">    CFHTTPMessageSetHeaderFieldValue(request, CFSTR(&quot;Sec-WebSocket-Key&quot;), (__bridge CFStringRef)_secKey);</div><div class="line">    CFHTTPMessageSetHeaderFieldValue(request, CFSTR(&quot;Sec-WebSocket-Version&quot;), (__bridge CFStringRef)[NSString stringWithFormat:@&quot;%ld&quot;, (long)_webSocketVersion]);</div><div class="line">    </div><div class="line">    CFHTTPMessageSetHeaderFieldValue(request, CFSTR(&quot;Origin&quot;), (__bridge CFStringRef)_url.SR_origin);</div><div class="line">    </div><div class="line">    if (_requestedProtocols) &#123;</div><div class="line">        CFHTTPMessageSetHeaderFieldValue(request, CFSTR(&quot;Sec-WebSocket-Protocol&quot;), (__bridge CFStringRef)[_requestedProtocols componentsJoinedByString:@&quot;, &quot;]);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    [_urlRequest.allHTTPHeaderFields enumerateKeysAndObjectsUsingBlock:^(id key, id obj, BOOL *stop) &#123;</div><div class="line">        CFHTTPMessageSetHeaderFieldValue(request, (__bridge CFStringRef)key, (__bridge CFStringRef)obj);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    NSData *message = CFBridgingRelease(CFHTTPMessageCopySerializedMessage(request));</div><div class="line">    </div><div class="line">    CFRelease(request);</div><div class="line"></div><div class="line">    [self _writeData:message];//socketè¿æ¥æˆåŠŸï¼Œå‘é€å®¢æˆ·ç«¯websocketæ¡æ‰‹è¯·æ±‚</div><div class="line">    [self _readHTTPHeader];//ç­‰å¾…å¹¶å¼€å§‹è¯»å–æœåŠ¡å™¨websocketæ¡æ‰‹å“åº”</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">- (void)_readHTTPHeader;</div><div class="line">&#123;</div><div class="line">    if (_receivedHTTPHeaders == NULL) &#123;</div><div class="line">        _receivedHTTPHeaders = CFHTTPMessageCreateEmpty(NULL, NO);</div><div class="line">    &#125;</div><div class="line">                        </div><div class="line">    [self _readUntilHeaderCompleteWithCallback:^(SRWebSocket *self,  NSData *data) &#123;</div><div class="line">        CFHTTPMessageAppendBytes(_receivedHTTPHeaders, (const UInt8 *)data.bytes, data.length);</div><div class="line">        </div><div class="line">        if (CFHTTPMessageIsHeaderComplete(_receivedHTTPHeaders)) &#123;</div><div class="line">            SRFastLog(@&quot;Finished reading headers %@&quot;, CFBridgingRelease(CFHTTPMessageCopyAllHeaderFields(_receivedHTTPHeaders)));</div><div class="line">            [self _HTTPHeadersDidFinish];</div><div class="line">        &#125; else &#123;</div><div class="line">            [self _readHTTPHeader];</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘æœ¬åœ°debugæ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„response headeræ•°æ®å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 101 Switching Protocols</div><div class="line">Server: Tengine/2.1.2</div><div class="line">Date: Thu, 15 Dec 2016 08:32:40 GMT</div><div class="line">Connection: upgrade</div><div class="line">Upgrade: websocket</div><div class="line">Sec-WebSocket-Accept: 0EDYPFTXV+u3rkKflAelaATKEvA=</div><div class="line">&lt;space-space-space-space-space-space-space-space-space-space</div></pre></td></tr></table></figure>
<p>æœ€åä¸€è¡Œæ˜¯ä¸€ä¸ªç©ºç™½è¡Œ,æ‰€ä»¥åˆ¤æ–­æ˜¯http headeræ˜¯å¦ç»“æŸçš„æ ‡å¿—å°±æ˜¯â€\r\n\r\nâ€ï¼Œè¯·æŸ¥çœ‹æºç 1262è¡Œã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">- (void)_HTTPHeadersDidFinish;</div><div class="line">&#123;</div><div class="line">    NSInteger responseCode = CFHTTPMessageGetResponseStatusCode(_receivedHTTPHeaders);    </div><div class="line">    if (responseCode &gt;= 400) &#123;</div><div class="line">	    ...</div><div class="line">	    ...</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">	...    </div><div class="line">    self.readyState = SR_OPEN;    </div><div class="line">    if (!_didFail) &#123;</div><div class="line">        [self _readFrameNew];//websocketåå•†å®Œæ¯•ï¼Œå¼€å§‹è¯»å–æ­£å¼æ•°æ®ã€‚</div><div class="line">    &#125;</div><div class="line">    [self _performDelegateBlock:^&#123;</div><div class="line">        if ([self.delegate respondsToSelector:@selector(webSocketDidOpen:)]) &#123;</div><div class="line">            [self.delegate webSocketDidOpen:self];</div><div class="line">        &#125;;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆªæ­¢åˆ°è¿™é‡Œï¼Œwebsocketåå•†å®Œæ¯•ï¼Œå¼€å§‹è¯»å–æ­£å¼æ•°æ®ã€‚å½“æ—¶ä»£ç çœ‹åˆ°è¿™é‡Œçš„æ—¶å€™æˆ‘ä¹Ÿæ¶ˆé™¤äº†ä¸€ä¸ªå†…å¿ƒçš„ç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆå¯¹é¢AndroidåŒäº‹åœ¨websocketè¿æ¥è¿‡ç¨‹ä¸­httpæŠ“åŒ…è½¯ä»¶å¯ä»¥æŠ“åˆ°ï¼Œè€Œæˆ‘ç”¨SocketRocketåˆ™å®Œå…¨æŠ“ä¸åˆ°ï¼ŸåŸå› å°±æ˜¯ï¼šæˆ‘ä»¬iOSæ‰‹æœºä¸æœåŠ¡å™¨ä¹‹é—´å·²ç»å»ºç«‹äº†ä¸€æ¡é•¿è¿æ¥ï¼Œç„¶åè‡ªå·±ç»„è£…websocketçš„http headerå‘é€å‡ºå»çš„ã€‚æ‰€ä»¥æ™®é€šçš„httpæŠ“åŒ…è½¯ä»¶åªèƒ½æŠ“ç©ºæ°”ï¼Œæƒ³è¦æŠ“æˆ‘ä»¬çš„åŒ…ï¼Œå¾—Wiresharkç­‰è¿™ç§æ›´å±Œçš„æŠ“åŒ…å·¥å…·æ‰è¡Œã€‚ï¼ˆæ·±æ·±çš„é„™è§†äº†ä¸€çœ¼å¯¹é¢çš„Androiderï¼‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (void)_readFrameNew;</div><div class="line">&#123;</div><div class="line">    dispatch_async(_workQueue, ^&#123;</div><div class="line">        [_currentFrameData setLength:0];        </div><div class="line">        _currentFrameOpcode = 0;</div><div class="line">        _currentFrameCount = 0;</div><div class="line">        _readOpCount = 0;</div><div class="line">        _currentStringScanPosition = 0;        </div><div class="line">        [self _readFrameContinue];</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line">- (void)_readFrameContinue;</div><div class="line">&#123;</div><div class="line">    assert((_currentFrameCount == 0 &amp;&amp; _currentFrameOpcode == 0) || (_currentFrameCount &gt; 0 &amp;&amp; _currentFrameOpcode &gt; 0));</div><div class="line"></div><div class="line">    [self _addConsumerWithDataLength:2 callback:^(SRWebSocket *self, NSData *data) &#123;</div><div class="line">        __block frame_header header = &#123;0&#125;;</div><div class="line">        </div><div class="line">        const uint8_t *headerBuffer = data.bytes;</div><div class="line">        assert(data.length &gt;= 2);</div><div class="line">        </div><div class="line">        if (headerBuffer[0] &amp; SRRsvMask) &#123;</div><div class="line">            [self _closeWithProtocolError:@&quot;Server used RSV bits&quot;];</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        uint8_t receivedOpcode = (SROpCodeMask &amp; headerBuffer[0]);</div><div class="line">        </div><div class="line">        BOOL isControlFrame = (receivedOpcode == SROpCodePing || receivedOpcode == SROpCodePong || receivedOpcode == SROpCodeConnectionClose);</div><div class="line">        </div><div class="line">        if (!isControlFrame &amp;&amp; receivedOpcode != 0 &amp;&amp; self-&gt;_currentFrameCount &gt; 0) &#123;</div><div class="line">            [self _closeWithProtocolError:@&quot;all data frames after the initial data frame must have opcode 0&quot;];</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        if (receivedOpcode == 0 &amp;&amp; self-&gt;_currentFrameCount == 0) &#123;</div><div class="line">            [self _closeWithProtocolError:@&quot;cannot continue a message&quot;];</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        header.opcode = receivedOpcode == 0 ? self-&gt;_currentFrameOpcode : receivedOpcode;</div><div class="line">        </div><div class="line">        header.fin = !!(SRFinMask &amp; headerBuffer[0]);</div><div class="line">        </div><div class="line">        </div><div class="line">        header.masked = !!(SRMaskMask &amp; headerBuffer[1]);</div><div class="line">        header.payload_length = SRPayloadLenMask &amp; headerBuffer[1];</div><div class="line">        </div><div class="line">        headerBuffer = NULL;</div><div class="line">        </div><div class="line">        if (header.masked) &#123;</div><div class="line">            [self _closeWithProtocolError:@&quot;Client must receive unmasked data&quot;];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        size_t extra_bytes_needed = header.masked ? sizeof(_currentReadMaskKey) : 0;</div><div class="line">        </div><div class="line">        if (header.payload_length == 126) &#123;</div><div class="line">            extra_bytes_needed += sizeof(uint16_t);</div><div class="line">        &#125; else if (header.payload_length == 127) &#123;</div><div class="line">            extra_bytes_needed += sizeof(uint64_t);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        if (extra_bytes_needed == 0) &#123;</div><div class="line">            [self _handleFrameHeader:header curData:self-&gt;_currentFrameData];</div><div class="line">        &#125; else &#123;</div><div class="line">            [self _addConsumerWithDataLength:extra_bytes_needed callback:^(SRWebSocket *self, NSData *data) &#123;</div><div class="line">                size_t mapped_size = data.length;</div><div class="line">                #pragma unused (mapped_size)</div><div class="line">                const void *mapped_buffer = data.bytes;</div><div class="line">                size_t offset = 0;</div><div class="line">                </div><div class="line">                if (header.payload_length == 126) &#123;</div><div class="line">                    assert(mapped_size &gt;= sizeof(uint16_t));</div><div class="line">                    uint16_t newLen = EndianU16_BtoN(*(uint16_t *)(mapped_buffer));</div><div class="line">                    header.payload_length = newLen;</div><div class="line">                    offset += sizeof(uint16_t);</div><div class="line">                &#125; else if (header.payload_length == 127) &#123;</div><div class="line">                    assert(mapped_size &gt;= sizeof(uint64_t));</div><div class="line">                    header.payload_length = EndianU64_BtoN(*(uint64_t *)(mapped_buffer));</div><div class="line">                    offset += sizeof(uint64_t);</div><div class="line">                &#125; else &#123;</div><div class="line">                    assert(header.payload_length &lt; 126 &amp;&amp; header.payload_length &gt;= 0);</div><div class="line">                &#125;</div><div class="line">                </div><div class="line">                if (header.masked) &#123;</div><div class="line">                    assert(mapped_size &gt;= sizeof(_currentReadMaskOffset) + offset);</div><div class="line">                    memcpy(self-&gt;_currentReadMaskKey, ((uint8_t *)mapped_buffer) + offset, sizeof(self-&gt;_currentReadMaskKey));</div><div class="line">                &#125;</div><div class="line">                </div><div class="line">                [self _handleFrameHeader:header curData:self-&gt;_currentFrameData];</div><div class="line">            &#125; readToCurrentFrame:NO unmaskBytes:NO];</div><div class="line">        &#125;</div><div class="line">    &#125; readToCurrentFrame:NO unmaskBytes:NO];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>SocketRocketæœ‰ä¸¤ä¸ªâ€œæ³µâ€æ–¹æ³•ï¼š_pumpWritingã€_pumpScannerï¼Œè¿™ä¸¤ä¸ªâ€œæ³µâ€ä¿è¯äº†websocketæ•°æ®çš„å‘é€ã€æ¥å—åŠŸèƒ½ã€‚è¿™ä¸¤ä¸ªâ€œæ³µâ€çš„ä»£ç å†™çš„å¾ˆä¸é”™å“¦ï¼Œå¾ˆå·§å¦™çš„è§£å†³äº†socketæ•°æ®çš„æ¥æ”¶è§£æå’Œå‘é€ï¼ŒæŒºæœ‰å‚è€ƒæ„ä¹‰çš„ï¼Œæ¯•ç«Ÿäººå®¶æ˜¯Facebookçš„ã€‚</p>
<hr>
<p>æœ‰ç©ºå†ç»§ç»­ï¼Œé‡Œé¢è¿˜æ˜¯æœ‰å¾ˆå¤šå°ç»†èŠ‚çš„ï¼Œè¿™äº›å°ç»†èŠ‚çš„å¤„ç†æ–¹æ³•ä¹Ÿæ˜¯å€¼å¾—æˆ‘ä»¬å­¦ä¹ çš„ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc6455#section-5.5.1&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;rfc6455 WebSockets æ ‡å‡†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http
    
    </summary>
    
    
      <category term="iOS/WebSocket/SocketRocketæºç " scheme="http://antyme.com/tags/iOS-WebSocket-SocketRocket%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>iOSåˆ¤æ–­å½“å‰è¾“å…¥æ³•æ˜¯ç³»ç»Ÿè‡ªå¸¦è¿˜æ˜¯ç¬¬ä¸‰æ–¹</title>
    <link href="http://antyme.com/2016/11/30/iOS%E5%88%A4%E6%96%AD%E5%BD%93%E5%89%8D%E8%BE%93%E5%85%A5%E6%B3%95%E6%98%AF%E7%B3%BB%E7%BB%9F%E8%87%AA%E5%B8%A6%E8%BF%98%E6%98%AF%E7%AC%AC%E4%B8%89%E6%96%B9/"/>
    <id>http://antyme.com/2016/11/30/iOSåˆ¤æ–­å½“å‰è¾“å…¥æ³•æ˜¯ç³»ç»Ÿè‡ªå¸¦è¿˜æ˜¯ç¬¬ä¸‰æ–¹/</id>
    <published>2016-11-30T03:30:07.000Z</published>
    <updated>2016-11-30T03:49:13.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://stackoverflow.com/questions/26153336/how-do-i-find-out-the-current-keyboard-used-on-ios8" target="_blank" rel="external">å‚è€ƒé“¾æ¥</a></p>
<p>ç›®å‰iOS SDKè¿˜æ²¡æœ‰å…¬å¼€è·å–å½“å‰é”®ç›˜çš„nameï¼Œä½†å›½å¤–å¤§ç¥æ‰¾åˆ°äº†â€œç°è‰²â€æ–¹æ³•å¯ä»¥è·å–åˆ°ï¼Œå‰ææ˜¯é”®ç›˜å¤„äºvisibleæ´»è·ƒçŠ¶æ€ã€‚ï¼ˆç°åœ¨è¿˜ä¸ç¡®å®šèƒ½å¦é€šè¿‡å®¡æ ¸ğŸ˜…ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">NSString *currentKeyboardName = [[[[UITextInputMode activeInputModes] filteredArrayUsingPredicate:[NSPredicate predicateWithFormat:@&quot;isDisplayed = YES&quot;]] lastObject] valueForKey:@&quot;extendedDisplayName&quot;];</div><div class="line">if ([currentKeyboardName isEqualToString:@&quot;ç®€ä½“æ‹¼éŸ³&quot;] || [currentKeyboardName isEqualToString:@&quot;è¡¨æƒ…ç¬¦å·&quot;] || [currentKeyboardName isEqualToString:@&quot;English (US)&quot;]) &#123;</div><div class="line">//ç³»ç»Ÿè‡ªå¸¦é”®ç›˜</div><div class="line">&#125; else &#123;</div><div class="line">//ç¬¬ä¸‰æ–¹é”®ç›˜ eg:ç™¾åº¦ã€æœç‹—ã€è®¯é£ç­‰</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/26153336/how-do-i-find-out-the-current-keyboard-used-on-ios8&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://antyme.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>OpenGLå­¦ä¹ ä¸ç†è§£</title>
    <link href="http://antyme.com/2016/09/25/OpenGL%E5%AD%A6%E4%B9%A0%E4%B8%8E%E7%90%86%E8%A7%A3/"/>
    <id>http://antyme.com/2016/09/25/OpenGLå­¦ä¹ ä¸ç†è§£/</id>
    <published>2016-09-25T07:41:11.000Z</published>
    <updated>2016-09-25T08:34:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨OpenGLä¸­ï¼Œä»»ä½•äº‹ç‰©éƒ½åœ¨3Dç©ºé—´ä¸­ï¼Œè€Œå±å¹•å’Œçª—å£å´æ˜¯2Dåƒç´ æ•°ç»„ï¼Œè¿™å¯¼è‡´OpenGLçš„å¤§éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯å…³äºæŠŠ3Dåæ ‡è½¬å˜ä¸ºé€‚åº”ä½ å±å¹•çš„2Dåƒç´ ã€‚3Dåæ ‡è½¬ä¸º2Dåæ ‡çš„å¤„ç†è¿‡ç¨‹æ˜¯ç”±OpenGLçš„å›¾å½¢æ¸²æŸ“ç®¡çº¿ï¼ˆGraphics Pipelineï¼Œå¤§å¤šè¯‘ä¸ºç®¡çº¿ï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯ä¸€å †åŸå§‹å›¾å½¢æ•°æ®é€”ç»ä¸€ä¸ªè¾“é€ç®¡é“ï¼ŒæœŸé—´ç»è¿‡å„ç§å˜åŒ–å¤„ç†æœ€ç»ˆå‡ºç°åœ¨å±å¹•çš„è¿‡ç¨‹ï¼‰ç®¡ç†çš„ã€‚å›¾å½¢æ¸²æŸ“ç®¡çº¿å¯ä»¥è¢«åˆ’åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼šç¬¬ä¸€éƒ¨åˆ†æŠŠä½ çš„3Dåæ ‡è½¬æ¢ä¸º2Dåæ ‡ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯æŠŠ2Dåæ ‡è½¬å˜ä¸ºå®é™…çš„æœ‰é¢œè‰²çš„åƒç´ ã€‚</p>
<p><img src="/images/pipeline.png" alt=""></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬ä»¥æ•°ç»„çš„å½¢å¼ä¼ é€’3ä¸ª3Dåæ ‡ä½œä¸ºå›¾å½¢æ¸²æŸ“ç®¡çº¿çš„è¾“å…¥ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªä¸‰è§’å½¢ï¼Œè¿™ä¸ªæ•°ç»„å«åšé¡¶ç‚¹æ•°æ®(Vertex Data)ï¼›é¡¶ç‚¹æ•°æ®æ˜¯ä¸€ç³»åˆ—é¡¶ç‚¹çš„é›†åˆã€‚ä¸€ä¸ªé¡¶ç‚¹(Vertex)æ˜¯ä¸€ä¸ª3Dåæ ‡çš„æ•°æ®çš„é›†åˆã€‚è€Œé¡¶ç‚¹æ•°æ®æ˜¯ç”¨é¡¶ç‚¹å±æ€§(Vertex Attribute)è¡¨ç¤ºçš„ï¼Œå®ƒå¯ä»¥åŒ…å«ä»»ä½•æˆ‘ä»¬æƒ³ç”¨çš„æ•°æ®ï¼Œä½†æ˜¯ç®€å•èµ·è§ï¼Œæˆ‘ä»¬è¿˜æ˜¯å‡å®šæ¯ä¸ªé¡¶ç‚¹åªç”±ä¸€ä¸ª3Dä½ç½®(è¯‘æ³¨1)å’Œä¸€äº›é¢œè‰²å€¼ç»„æˆçš„å§ã€‚</p>
<p>å›¾å½¢æ¸²æŸ“ç®¡çº¿çš„ç¬¬ä¸€ä¸ªéƒ¨åˆ†æ˜¯é¡¶ç‚¹ç€è‰²å™¨(Vertex Shader)ï¼Œå®ƒæŠŠä¸€ä¸ªå•ç‹¬çš„é¡¶ç‚¹ä½œä¸ºè¾“å…¥ã€‚é¡¶ç‚¹ç€è‰²å™¨ä¸»è¦çš„ç›®çš„æ˜¯æŠŠ3Dåæ ‡è½¬ä¸ºå¦ä¸€ç§3Dåæ ‡ï¼ˆåé¢ä¼šè§£é‡Šï¼‰ï¼ŒåŒæ—¶é¡¶ç‚¹ç€è‰²å™¨å…è®¸æˆ‘ä»¬å¯¹é¡¶ç‚¹å±æ€§è¿›è¡Œä¸€äº›åŸºæœ¬å¤„ç†ã€‚</p>
<p>å›¾å…ƒè£…é…(Primitive Assembly)é˜¶æ®µå°†é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºçš„æ‰€æœ‰é¡¶ç‚¹ä½œä¸ºè¾“å…¥ï¼ˆå¦‚æœæ˜¯GL_POINTSï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªé¡¶ç‚¹ï¼‰ï¼Œå¹¶æ‰€æœ‰çš„ç‚¹è£…é…æˆæŒ‡å®šå›¾å…ƒçš„å½¢çŠ¶ï¼›æœ¬èŠ‚ä¾‹å­ä¸­æ˜¯ä¸€ä¸ªä¸‰è§’å½¢ã€‚</p>
<p>å›¾å…ƒè£…é…é˜¶æ®µçš„è¾“å‡ºä¼šä¼ é€’ç»™å‡ ä½•ç€è‰²å™¨(Geometry Shader)ã€‚å‡ ä½•ç€è‰²å™¨æŠŠå›¾å…ƒå½¢å¼çš„ä¸€ç³»åˆ—é¡¶ç‚¹çš„é›†åˆä½œä¸ºè¾“å…¥ï¼Œå®ƒå¯ä»¥é€šè¿‡äº§ç”Ÿæ–°é¡¶ç‚¹æ„é€ å‡ºæ–°çš„ï¼ˆæˆ–æ˜¯å…¶å®ƒçš„ï¼‰å›¾å…ƒæ¥ç”Ÿæˆå…¶ä»–å½¢çŠ¶ã€‚ä¾‹å­ä¸­ï¼Œå®ƒç”Ÿæˆäº†å¦ä¸€ä¸ªä¸‰è§’å½¢ã€‚</p>
<p>å‡ ä½•ç€è‰²å™¨çš„è¾“å‡ºä¼šè¢«ä¼ å…¥å…‰æ …åŒ–é˜¶æ®µ(Rasterization Stage)ï¼Œè¿™é‡Œå®ƒä¼šæŠŠå›¾å…ƒæ˜ å°„ä¸ºæœ€ç»ˆå±å¹•ä¸Šç›¸åº”çš„åƒç´ ï¼Œç”Ÿæˆä¾›ç‰‡æ®µç€è‰²å™¨(Fragment Shader)ä½¿ç”¨çš„ç‰‡æ®µ(Fragment)ã€‚åœ¨ç‰‡æ®µç€è‰²å™¨è¿è¡Œä¹‹å‰ä¼šæ‰§è¡Œè£åˆ‡(Clipping)ã€‚è£åˆ‡ä¼šä¸¢å¼ƒè¶…å‡ºä½ çš„è§†å›¾ä»¥å¤–çš„æ‰€æœ‰åƒç´ ï¼Œç”¨æ¥æå‡æ‰§è¡Œæ•ˆç‡ã€‚</p>
<blockquote>
<p>OpenGLä¸­çš„ä¸€ä¸ªç‰‡æ®µæ˜¯OpenGLæ¸²æŸ“ä¸€ä¸ªåƒç´ æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ã€‚</p>
</blockquote>
<p>ç‰‡æ®µç€è‰²å™¨çš„ä¸»è¦ç›®çš„æ˜¯è®¡ç®—ä¸€ä¸ªåƒç´ çš„æœ€ç»ˆé¢œè‰²ï¼Œè¿™ä¹Ÿæ˜¯æ‰€æœ‰OpenGLé«˜çº§æ•ˆæœäº§ç”Ÿçš„åœ°æ–¹ã€‚é€šå¸¸ï¼Œç‰‡æ®µç€è‰²å™¨åŒ…å«3Dåœºæ™¯çš„æ•°æ®ï¼ˆæ¯”å¦‚å…‰ç…§ã€é˜´å½±ã€å…‰çš„é¢œè‰²ç­‰ç­‰ï¼‰ï¼Œè¿™äº›æ•°æ®å¯ä»¥è¢«ç”¨æ¥è®¡ç®—æœ€ç»ˆåƒç´ çš„é¢œè‰²ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨OpenGLä¸­ï¼Œä»»ä½•äº‹ç‰©éƒ½åœ¨3Dç©ºé—´ä¸­ï¼Œè€Œå±å¹•å’Œçª—å£å´æ˜¯2Dåƒç´ æ•°ç»„ï¼Œè¿™å¯¼è‡´OpenGLçš„å¤§éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯å…³äºæŠŠ3Dåæ ‡è½¬å˜ä¸ºé€‚åº”ä½ å±å¹•çš„2Dåƒç´ ã€‚3Dåæ ‡è½¬ä¸º2Dåæ ‡çš„å¤„ç†è¿‡ç¨‹æ˜¯ç”±OpenGLçš„å›¾å½¢æ¸²æŸ“ç®¡çº¿ï¼ˆGraphics Pipelineï¼Œå¤§å¤šè¯‘ä¸ºç®¡çº¿ï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯ä¸€
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOSå¼€å‘ä¸­æ–¹ä¾¿å¥½ç”¨çš„Cè¯­è¨€å®</title>
    <link href="http://antyme.com/2016/08/18/C%E8%AF%AD%E8%A8%80%E5%AE%8F%E7%9A%84%E7%89%B9%E6%AE%8A%E7%94%A8%E6%B3%95%E5%92%8C%E5%87%A0%E4%B8%AA%E5%9D%91/"/>
    <id>http://antyme.com/2016/08/18/Cè¯­è¨€å®çš„ç‰¹æ®Šç”¨æ³•å’Œå‡ ä¸ªå‘/</id>
    <published>2016-08-18T10:51:22.000Z</published>
    <updated>2016-12-08T08:08:18.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®ç‰¹æ®Šç”¨æ³•"><a href="#å®ç‰¹æ®Šç”¨æ³•" class="headerlink" title="å®ç‰¹æ®Šç”¨æ³•"></a>å®ç‰¹æ®Šç”¨æ³•</h2><h3 id="1-å­—ç¬¦ä¸²åŒ–-Stringification"><a href="#1-å­—ç¬¦ä¸²åŒ–-Stringification" class="headerlink" title="1. å­—ç¬¦ä¸²åŒ–(Stringification)"></a>1. å­—ç¬¦ä¸²åŒ–(Stringification)</h3><p>åœ¨å®ä½“ä¸­ï¼Œå¦‚æœå®å‚æ•°å‰åŠ ä¸ª<strong>#</strong>ï¼Œé‚£ä¹ˆåœ¨å®ä½“æ‰©å±•çš„æ—¶å€™ï¼Œå®å‚æ•°ä¼šè¢«æ‰©å±•æˆå­—ç¬¦ä¸²çš„å½¢å¼ã€‚å¦‚ï¼š</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WARN_IF(EXP) \</span></div><div class="line">do &#123; <span class="meta-keyword">if</span> (EXP) \</div><div class="line">	fprintf (stderr, <span class="meta-string">"Warning: "</span> #EXP <span class="meta-string">"\n"</span>); &#125; \</div><div class="line">while (0)</div></pre></td></tr></table></figure>
<p><strong>WARN_IF (x == 0);</strong>ä¼šè¢«æ‰©å±•æˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">do </div><div class="line">&#123; </div><div class="line">	if (x == 0)</div><div class="line">		fprintf (stderr, &quot;Warning: &quot; &quot;x == 0&quot; &quot;\n&quot;); </div><div class="line">&#125;</div><div class="line">while (0);</div></pre></td></tr></table></figure>
<p>è¿™ç§ç”¨æ³•å¯ä»¥ç”¨åœ¨assertä¸­ï¼Œå¦‚æœæ–­è¨€å¤±è´¥ï¼Œå¯ä»¥å°†å¤±è´¥çš„è¯­å¥è¾“å‡ºåˆ°åé¦ˆä¿¡æ¯ä¸­</p>
<h3 id="2-è¿æ¥-Concatenation"><a href="#2-è¿æ¥-Concatenation" class="headerlink" title="2. è¿æ¥(Concatenation)"></a>2. è¿æ¥(Concatenation)</h3><p>åœ¨å®ä½“ä¸­ï¼Œå¦‚æœå®ä½“æ‰€åœ¨æ ‡ç¤ºç¬¦ä¸­æœ‰<strong>##</strong>ï¼Œé‚£ä¹ˆåœ¨å®ä½“æ‰©å±•çš„æ—¶å€™ï¼Œå®å‚æ•°ä¼šè¢«ç›´æ¥æ›¿æ¢åˆ°æ ‡ç¤ºç¬¦ä¸­ã€‚å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#define COMMAND(NAME)  &#123; #NAME, NAME ## _command &#125;</div><div class="line">struct command</div><div class="line">&#123;</div><div class="line">    char *name;</div><div class="line">    void (*function) (void);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>åœ¨å®æ‰©å±•çš„æ—¶å€™ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">struct command commands[] =</div><div class="line">&#123;</div><div class="line">    COMMAND (quit),</div><div class="line">    COMMAND (help),</div><div class="line">    ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>ä¼šè¢«æ‰©å±•æˆï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">struct command commands[] =</div><div class="line">&#123;</div><div class="line">    &#123; &quot;quit&quot;, quit_command &#125;,</div><div class="line">    &#123; &quot;help&quot;, help_command &#125;,</div><div class="line">    ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>è¿™æ ·å°±èŠ‚çœäº†å¤§é‡æ—¶é—´ï¼Œæé«˜æ•ˆç‡ã€‚</p>
<h3 id="3-iOSä¸­å®šä¹‰æ˜ç¡®ç±»å‹çš„æ¨¡æ¿å®¹å™¨"><a href="#3-iOSä¸­å®šä¹‰æ˜ç¡®ç±»å‹çš„æ¨¡æ¿å®¹å™¨" class="headerlink" title="3. iOSä¸­å®šä¹‰æ˜ç¡®ç±»å‹çš„æ¨¡æ¿å®¹å™¨"></a>3. iOSä¸­å®šä¹‰æ˜ç¡®ç±»å‹çš„æ¨¡æ¿å®¹å™¨</h3><p>å®šä¹‰NSArrayã€NSMutableArrayã€NSDictionaryã€NSMutableDictionaryç­‰æ³›å‹å®¹å™¨æ—¶æœ€å¥½æŒ‡å®šç±»å‹ï¼Œè¿™æ ·ä¸ä½†å¯ä»¥å……åˆ†åˆ©ç”¨Xcodeçš„è‡ªåŠ¨å®ŒæˆåŠŸèƒ½ï¼Œæå‡æ•ˆç‡ï¼Œè€Œä¸”ä¾¿äºä»£ç çš„ç»´æŠ¤ã€‚<br>ä¸‹é¢çš„å®å¯ä»¥å¸®ä½ å¿«é€Ÿå®ç°è¿™ä¸€ç‚¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#if __has_feature(objc_generics)</div><div class="line">#   define TM__GENERICS(class, ...)         class&lt;__VA_ARGS__&gt;</div><div class="line">#else</div><div class="line">#   define TM__GENERICS(class, ...)         class</div><div class="line">#endif</div><div class="line"></div><div class="line">#define TMMutableArrayWith(valueType)                   TM__GENERICS(NSMutableArray, valueType)</div><div class="line">#define TMMutableDictionaryWith(keyType, valueType)     TM__GENERICS(NSMutableDictionary, keyType, valueType)</div></pre></td></tr></table></figure>
<h3 id="æœªå®Œå¾…è¡¥å……â€¦"><a href="#æœªå®Œå¾…è¡¥å……â€¦" class="headerlink" title="æœªå®Œå¾…è¡¥å……â€¦"></a>æœªå®Œå¾…è¡¥å……â€¦</h3><hr>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å®ç‰¹æ®Šç”¨æ³•&quot;&gt;&lt;a href=&quot;#å®ç‰¹æ®Šç”¨æ³•&quot; class=&quot;headerlink&quot; title=&quot;å®ç‰¹æ®Šç”¨æ³•&quot;&gt;&lt;/a&gt;å®ç‰¹æ®Šç”¨æ³•&lt;/h2&gt;&lt;h3 id=&quot;1-å­—ç¬¦ä¸²åŒ–-Stringification&quot;&gt;&lt;a href=&quot;#1-å­—ç¬¦ä¸²åŒ–-Stringificat
    
    </summary>
    
    
      <category term="c/c++" scheme="http://antyme.com/tags/c-c/"/>
    
  </entry>
  
  <entry>
    <title>gitå¥½ç”¨å®¹æ˜“å¿˜è®°çš„å‘½ä»¤</title>
    <link href="http://antyme.com/2016/08/18/git%E5%A5%BD%E7%94%A8%E5%AE%B9%E6%98%93%E5%BF%98%E8%AE%B0%E7%9A%84%E5%91%BD%E4%BB%A4/"/>
    <id>http://antyme.com/2016/08/18/gitå¥½ç”¨å®¹æ˜“å¿˜è®°çš„å‘½ä»¤/</id>
    <published>2016-08-18T10:30:48.000Z</published>
    <updated>2018-01-20T09:15:04.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="gitå¥½ç”¨å®¹æ˜“å¿˜è®°çš„å‘½ä»¤"><a href="#gitå¥½ç”¨å®¹æ˜“å¿˜è®°çš„å‘½ä»¤" class="headerlink" title="gitå¥½ç”¨å®¹æ˜“å¿˜è®°çš„å‘½ä»¤"></a><strong>gitå¥½ç”¨å®¹æ˜“å¿˜è®°çš„å‘½ä»¤</strong></h3><p>1ã€ç§»é™¤æ–‡ä»¶</p>
<pre><code>åˆ é™¤æœ¬åœ°å’Œgitè·Ÿè¸ªï¼š
    git rm
åªåˆ é™¤gitè·Ÿè¸ªï¼Œä¿ç•™æœ¬åœ°ï¼š
    git rm --cached æ–‡ä»¶å
</code></pre><p>2ã€ç§»åŠ¨æ–‡ä»¶</p>
<pre><code>git mv srcName dstName
ç›¸å½“äº
mv srcName dstName
git rm srcName
git add dstName
</code></pre><p>3ã€æŸ¥çœ‹æ—¥å¿—</p>
<pre><code>git log
ä»…å±•ç¤ºç®€è¦çš„å¢æ”¹è¡Œæ•°ç»Ÿè®¡
git log --stat
ä½¿ç”¨prettyé€‰é¡¹é€‚åˆè‡ªå·±é£æ ¼çš„æ ¼å¼
git log --pretty=oneline
git log --pretty=short
git log --pretty=full
git log --pretty=fuller
git log --pretty=format:&quot;%h - %an, %ar : %s&quot;

formatå‚æ•°è¯´æ˜ï¼š
%H æäº¤å¯¹è±¡ï¼ˆcommitï¼‰çš„å®Œæ•´å“ˆå¸Œå­—ç¬¦ä¸²
%h    æäº¤å¯¹è±¡çš„ç®€çŸ­å“ˆå¸Œå­—ç¬¦ä¸²
%T    æ ‘å¯¹è±¡ï¼ˆtreeï¼‰çš„å®Œæ•´å“ˆå¸Œå­—ç¬¦ä¸²
%t    æ ‘å¯¹è±¡çš„ç®€çŸ­å“ˆå¸Œå­—ç¬¦ä¸²
%P    çˆ¶å¯¹è±¡ï¼ˆparentï¼‰çš„å®Œæ•´å“ˆå¸Œå­—ç¬¦ä¸²
%p    çˆ¶å¯¹è±¡çš„ç®€çŸ­å“ˆå¸Œå­—ç¬¦ä¸²
%an    ä½œè€…ï¼ˆauthorï¼‰çš„åå­—
%ae    ä½œè€…çš„ç”µå­é‚®ä»¶åœ°å€
%ad    ä½œè€…ä¿®è®¢æ—¥æœŸï¼ˆå¯ä»¥ç”¨ -date= é€‰é¡¹å®šåˆ¶æ ¼å¼ï¼‰
%ar    ä½œè€…ä¿®è®¢æ—¥æœŸï¼ŒæŒ‰å¤šä¹…ä»¥å‰çš„æ–¹å¼æ˜¾ç¤º
%cn    æäº¤è€…ï¼ˆcommitterï¼‰çš„åå­—
%ce    æäº¤è€…çš„ç”µå­é‚®ç®±åœ°å€
%cd    æäº¤æ—¥æœŸ
%cr    æäº¤æ—¥æœŸï¼ŒæŒ‰å¤šä¹…ä»¥å‰çš„æ–¹å¼æ˜¾ç¤º
%s    æäº¤è¯´æ˜

git logå¸¸ç”¨å‘½ä»¤é€‰é¡¹ï¼š
-p                æŒ‰è¡¥ä¸æ ¼å¼æ˜¾ç¤ºæ¯ä¸ªæ›´æ–°ä¹‹é—´çš„å·®å¼‚
--stat            æ˜¾ç¤ºæ¯æ¬¡æ›´æ–°çš„æ–‡ä»¶ä¿®æ”¹ç»Ÿè®¡ä¿¡æ¯
--shortstat        åªæ˜¾ç¤º--statä¸­æœ€åçš„è¡Œæ•°ä¿®æ”¹æ·»åŠ ç§»é™¤ç»Ÿè®¡
--name-only        ä»…åœ¨æäº¤ä¿¡æ¯åæ˜¾ç¤ºå·²ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•
--name-status    æ˜¾ç¤ºæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤çš„æ–‡ä»¶æ¸…å•
--abbrev-commit    ä»…æ˜¾ç¤ºSHA-1çš„å‰å‡ ä¸ªå­—ç¬¦ï¼Œè€Œéæ‰€æœ‰çš„40ä¸ªå­—ç¬¦
--relative-date    ä½¿ç”¨è¾ƒçŸ­çš„ç›¸å¯¹æ—¶é—´æ˜¾ç¤ºï¼ˆæ¯”å¦‚ï¼Œâ€œ2 week agoâ€ï¼‰
--graph            æ˜¾ç¤ºASCIIå›¾å½¢è¡¨ç¤ºçš„åˆ†æ”¯åˆå¹¶å†å²
--pretty        ä½¿ç”¨å…¶ä»–æ ¼å¼æ˜¾ç¤ºå†å²æäº¤ä¿¡æ¯ã€‚å¯ç”¨çš„é€‰é¡¹åŒ…æ‹¬onelineã€shortã€fullã€fullerå’Œformatï¼ˆåè·ŸæŒ‡å®šæ ¼å¼ï¼‰
-n                     ä»…æ˜¾ç¤ºæœ€è¿‘çš„næ¡æäº¤
--since, --after    ä»…æ˜¾ç¤ºæŒ‡å®šæ—¶é—´ä¹‹åçš„æäº¤
--until, --before    ä»…æ˜¾ç¤ºæŒ‡å®šæ—¶é—´ä¹‹å‰çš„æäº¤
--author            ä»…æ˜¾ç¤ºæŒ‡å®šä½œè€…ç›¸å…³çš„æäº¤
--committer            ä»…æ˜¾ç¤ºæŒ‡å®šæäº¤è€…ç›¸å…³çš„æäº¤

git log --since=2.minutes
git log --since=2.weeks
git log --before=&quot;2016-08-17&quot;
git log --after=&quot;2016-08-16&quot; --before=&quot;2018-08-17&quot;
</code></pre><p>4ã€å­æ¨¡å—ï¼ˆsubmoduleï¼‰</p>
<pre><code>æ·»åŠ æ–°çš„å­æ¨¡å—
git submodule add https://github.com/chaconinc/DbConnector

å­˜äº†é¡¹ç›® URL ä¸å·²ç»æ‹‰å–çš„æœ¬åœ°ç›®å½•ä¹‹é—´çš„æ˜ å°„
cat .gitmodules

å…‹éš†å«æœ‰å­æ¨¡å—çš„é¡¹ç›®
git clone --recursive https://github.com/chaconinc/MainProject

å¦‚æœä½ ä¸æƒ³åœ¨å­ç›®å½•ä¸­æ‰‹åŠ¨æŠ“å–ä¸åˆå¹¶ï¼Œé‚£ä¹ˆè¿˜æœ‰ç§æ›´å®¹æ˜“çš„æ–¹å¼ã€‚ è¿è¡Œå‘½ä»¤
git submodule update --recursive --remote Gitå°†ä¼šè¿›å…¥å­æ¨¡å—ç„¶åæŠ“å–å¹¶æ›´æ–°ã€‚

git submodule deinit asubmodule

git rm --cached asubmodule

rm -rf .git/modules/asubmodule
</code></pre><p>5ã€å¼€å¯socks5ä»£ç†</p>
<pre><code>git config --global http.proxy &apos;socks5://127.0.0.1:1080&apos; 
git config --global https.proxy &apos;socks5://127.0.0.1:1080&apos;
</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;gitå¥½ç”¨å®¹æ˜“å¿˜è®°çš„å‘½ä»¤&quot;&gt;&lt;a href=&quot;#gitå¥½ç”¨å®¹æ˜“å¿˜è®°çš„å‘½ä»¤&quot; class=&quot;headerlink&quot; title=&quot;gitå¥½ç”¨å®¹æ˜“å¿˜è®°çš„å‘½ä»¤&quot;&gt;&lt;/a&gt;&lt;strong&gt;gitå¥½ç”¨å®¹æ˜“å¿˜è®°çš„å‘½ä»¤&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;1ã€ç§»é™¤æ–‡ä»¶&lt;/p&gt;
&lt;p
    
    </summary>
    
    
      <category term="git" scheme="http://antyme.com/tags/git/"/>
    
  </entry>
  
</feed>
